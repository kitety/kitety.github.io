<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/img/2.jpg?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/img/2.jpg?v=2.6.2" type="image/png" sizes="32x32"><meta name="google-site-verification" content="AFckh8Qum4gkYDApoahauJPbChPexSCeRwCUwgm2gS4"><meta name="msvalidate.01" content="hexo-generator-sitemap"><meta name="baidu-site-verification" content="nMdTVRLxht9WqNnh"><meta name="360-site-verification" content="461054bb1c1cb4a6732535e9f942d8e7"><meta name="sogou_site_verification" content="lzrIYG4bxk"><meta name="description" content="前言       用一篇文章来记录我的Mysql学习笔记。"><meta property="og:type" content="article"><meta property="og:title" content="Mysql 学习笔记"><meta property="og:url" content="https://kitety.github.io/posts/mysql-study-note.html"><meta property="og:site_name" content="别样"><meta property="og:description" content="前言       用一篇文章来记录我的Mysql学习笔记。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/20220904180157.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql1.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql2.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql3.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql4.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql5.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql6.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql7.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql8.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql9.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql10.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql11.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql12.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql13.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql14.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql15.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql16.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql17.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql18.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql19.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql20.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql21.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql22.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql23.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql24.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql25.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql26.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql27.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/20220905163945.png"><meta property="article:published_time" content="2022-09-04T09:54:20.000Z"><meta property="article:modified_time" content="2024-08-09T14:44:23.825Z"><meta property="article:author" content="kitety"><meta property="article:tag" content="mysql"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/20220904180157.png"><title>Mysql 学习笔记 | 别样</title><link ref="canonical" href="https://kitety.github.io/posts/mysql-study-note.html"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" type="text/css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="dns-prefetch" href="https://hm.baidu.com"><script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" data-ad-client="ca-pub-4938003046784968" async data-pjax=""></script><script src="https://www.googletagmanager.com/gtag/js?id=UA-161566224-1" async data-pjax=""></script><script data-pjax="">function gtag(){dataLayer.push(arguments)}"localhost"!==window.location.hostname&&(window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-161566224-1"))</script><script>var _hmt=_hmt||[];!function(){var t=document.createElement("script"),e=(t.src="https://hm.baidu.com/hm.js?f5b61933887642fff88ca20c0ddf1ab6",t.async=!0,t.setAttribute("data-pjax",""),document.getElementsByTagName("script")[0]);e.parentNode.insertBefore(t,e)}()</script><script>var Stun=window.Stun||{},CONFIG={root:"/",algolia:void 0,assistSearch:["google","bing","baidu"],fontIcon:{prompt:{success:"fas fa-check-circle",info:"fas fa-arrow-circle-right",warning:"fas fa-exclamation-circle",error:"fas fa-times-circle"},copyBtn:"fas fa-copy"},sidebar:{offsetTop:"20px",tocMaxDepth:6},header:void 0,postWidget:{endText:!0},nightMode:{enable:!0},back2top:{enable:!0},codeblock:{style:"default",highlight:"light",wordWrap:!1},reward:!0,fancybox:!0,zoomImage:{gapAside:"20px"},galleryWaterfall:void 0,lazyload:!0,pjax:{avoidBanner:!1},externalLink:{icon:{enable:!0,name:"fas fa-external-link-alt"}},shortcuts:{switchPost:!0},prompt:{copyButton:"复制",copySuccess:"复制成功",copyError:"复制失败"},sourcePath:{js:"js",css:"css",images:"images"}};window.CONFIG=CONFIG</script><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="别样" type="application/atom+xml"></head><body class="body"><div class="container" id="container"><header class="header" id="header"><div class="header-inner header-inner--height header-inner--bgcolor"><nav class="header-nav header-nav--sticky"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">首页</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">归档</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">标签</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/shuoshuo"><span class="header-nav-menu-item__icon"><i class="fa-heartbeat fa"></i></span><span class="header-nav-menu-item__text">一些话</span></a></div></div><div class="header-nav-search"><span class="header-nav-search__icon"><i class="fas fa-search"></i></span><span class="header-nav-search__text">搜索</span></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div><div class="site-nav" id="google_translate_element"></div><script type="text/javascript">function googleTranslateElementInit(){new google.translate.TranslateElement({pageLanguage:"zh-CN",layout:google.translate.TranslateElement.InlineLayout.SIMPLE,autoDisplay:!1},"google_translate_element")}</script><script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script></div></nav></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><div id="is-post"><div class="new-site"><a href="https://www.kitety.com/" target="_blank">博客更换网址了，点击访问！</a></div></div><div class="post"><header class="post-header"><h1 class="post-title">Mysql 学习笔记</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2022-09-04</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2024-08-09</span></span><span class="post-meta-item post-meta-item--wordcount"><span class="post-meta-item__icon"><i class="far fa-file-word"></i></span><span class="post-meta-item__info">字数统计</span><span class="post-meta-item__value">14.6k</span></span><span class="post-meta-item post-meta-item--readtime"><span class="post-meta-item__icon"><i class="far fa-clock"></i></span><span class="post-meta-item__info">阅读时长</span><span class="post-meta-item__value">105分</span></span><span class="post-meta-item post-meta-item--visitors"><span class="post-meta-item__icon"><i class="fas fa-eye"></i></span><span class="post-meta-item__info">阅读次数</span><span class="post-meta-item__value" id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body"><h2 id="前言"><a href="#前言" class="heading-link"><i class="fas fa-link"></i></a><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>用一篇文章来记录我的Mysql学习笔记。<br><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/20220904180157.png"></p><span id="more"></span><h2 id="基本"><a href="#基本" class="heading-link"><i class="fas fa-link"></i></a><a href="#基本" class="headerlink" title="基本"></a>基本</h2><p>树状结构</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql.png" alt="Untitled"></p><ol><li>一个节点只能有一个父节点，根结点除外，不然需要引入冗余节点</li><li>查询速度满，从根节点开始，树状结构</li><li>每个父节点不能脱离父节点单独存在，父节点删除，自节点全部删除</li></ol><p>关系型 表结构</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql1.png" alt="关系型数据库"></p><p>关系型数据库</p><p>不会有冗余数据，删除一条数据，不会影响其他</p><h2 id="安装mysql"><a href="#安装mysql" class="heading-link"><i class="fas fa-link"></i></a><a href="#安装mysql" class="headerlink" title="安装mysql"></a>安装mysql</h2><p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://www.runoob.com/mysql/mysql-install.html">安装mysql</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><h2 id="链接和断开"><a href="#链接和断开" class="heading-link"><i class="fas fa-link"></i></a><a href="#链接和断开" class="headerlink" title="链接和断开"></a>链接和断开</h2><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mysql -u root -p1234qwer!<br></code></pre></td></tr></table></div></figure><p>退出</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">exit</span>； quit；\q<br></code></pre></td></tr></table></div></figure><p>显示数据库</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">show databases;<br></code></pre></td></tr></table></div></figure><p>3.1 informationschema</p><p>保存着关于MySQL服务器所维护的所有其他数据库的信息。</p><p>如数据库名，数据库的表，表栏的数据类型与访问权限等</p><p>3.2 mysql</p><p>MySaL系统数据库，保存了登录用户名，密码，以及每个用户的权限等等</p><p>3.3 performance_schema</p><p>用来保存数据库服务器性能的参数</p><p>3.4 sys</p><p>这个库是通过视图的形式把information schema 利lperformence schema结合起来，查询出更加令人容易理解的数据</p><h2 id="其他概念"><a href="#其他概念" class="heading-link"><i class="fas fa-link"></i></a><a href="#其他概念" class="headerlink" title="其他概念"></a>其他概念</h2><p>学习数据库的增删改查（数据库，数据表，数据）</p><p>SQL</p><p>SQL语句功能划分</p><p>DDL：数据定义语句</p><p>用来定义数据库对象：创建库，表，列等。</p><p>DML：数据操作语句</p><p>用来操作数据库表中的记录</p><p>DQL：数据查询语句</p><p>用来查询数据</p><p>DCL：数据控制语句</p><p>用来定义访问权限和安全级别</p><p>数据类型分类</p><ol><li>数值类型</li><li>字符串类型</li><li>日期和时间类型</li></ol><p>MySQL中常用的数据类型如下：</p><p>Double 浮点型，例如double(5,2)表示最多5位，其中必须有2位小数，即最大值为999.99；</p><p>Char：固定长度字符串类型：char (10) ‘ Inj</p><p>Varchar：可变长度字符串类型：varchar(10) ‘ Inj text：字符串类型：</p><p>Blob：二进制类型：</p><p>日期：日期类型，格式为：yyyyy-MM-dd；</p><p>时间：时间类型，格式为：hh：mm：ss</p><p>Datetime：日期时间类型 yyyy-M-dd hh：mm：Ss</p><p>注意点：在mysql中，字符串类型和日期类型都要用单引号括起来。‘Inj’ ‘2022-02-02’</p><h2 id="数据库的创建"><a href="#数据库的创建" class="heading-link"><i class="fas fa-link"></i></a><a href="#数据库的创建" class="headerlink" title="数据库的创建"></a>数据库的创建</h2><p>电脑数据的编码，gbk存，utf8存？，<strong>创建的时候应该指定编码</strong></p><p>创建数据库</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">create database name1;<br>// 没有就创建，有的话就报错<br></code></pre></td></tr></table></div></figure><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">create database <span class="hljs-keyword">if</span> not exists name1;<br>// 有就跳过，没有就创建 good<br></code></pre></td></tr></table></div></figure><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">create database <span class="hljs-keyword">if</span> not exists name1 charset=字符集;<br>// 指定字符集<br>create database <span class="hljs-keyword">if</span> not exists test3 charset=utf8;<br></code></pre></td></tr></table></div></figure><p>注意关键字</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">create database <span class="hljs-keyword">if</span> not exists `create`  charset=utf8;<br>// `create`包裹起来<br>// 注意点：如果数据库的名称是SQL的关键字或者是一些特殊字符中!@这个时候就需要用反引号括起米<br></code></pre></td></tr></table></div></figure><p>查看数据库</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">show databases;<br></code></pre></td></tr></table></div></figure><p>查看数据库全局默认编码</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">show variables like <span class="hljs-string">&#x27;character_set_%&#x27;</span>;<br></code></pre></td></tr></table></div></figure><p>查看一个数据库编码</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">show create database name;<br></code></pre></td></tr></table></div></figure><blockquote><p>| test1 | CREATE DATABASE <code>test1</code> /*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci <em>/ /</em>!80016 DEFAULT ENCRYPTION=’N’ */ |</p></blockquote><h2 id="数据库的删除"><a href="#数据库的删除" class="heading-link"><i class="fas fa-link"></i></a><a href="#数据库的删除" class="headerlink" title="数据库的删除"></a>数据库的删除</h2><p>删除数据库</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">drop database name;<br>// 没有这个数据库会报错<br>// Can<span class="hljs-string">&#x27;t drop database &#x27;</span>name<span class="hljs-string">&#x27;; database doesn&#x27;</span>t exist<br></code></pre></td></tr></table></div></figure><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">drop database <span class="hljs-keyword">if</span> exists name;<br>// 没有这个数据库不会报错，跳过<br></code></pre></td></tr></table></div></figure><h2 id="数据库的修改和查看"><a href="#数据库的修改和查看" class="heading-link"><i class="fas fa-link"></i></a><a href="#数据库的修改和查看" class="headerlink" title="数据库的修改和查看"></a>数据库的修改和查看</h2><p>修改数据库的字符集</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">alter database name charset=字符集;<br>// alter database test1 charset=gbk;<br></code></pre></td></tr></table></div></figure><p>查看数据库</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">show create database name; // 查看字符集<br>show databases; // 查看数据库<br></code></pre></td></tr></table></div></figure><h2 id="表的增删改查"><a href="#表的增删改查" class="heading-link"><i class="fas fa-link"></i></a><a href="#表的增删改查" class="headerlink" title="表的增删改查"></a>表的增删改查</h2><p><strong>注意 ： 需要制定一个数据库</strong></p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">use name；<br></code></pre></td></tr></table></div></figure><p>查看数据库中的表</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">show tables;<br></code></pre></td></tr></table></div></figure><p>创建表</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">create table name(<br>	字段名称 数据类型，<br>  字段名称 数据类型，<br>  字段名称 数据类型，<br>);<br>// 没这个表会成功，有这个表会失败<br>create table stu(<br>	<span class="hljs-built_in">id</span> int,<br>	name text	<br>);<br>// 修复<br>create table <span class="hljs-keyword">if</span> not exists person(<br>	<span class="hljs-built_in">id</span> int,<br>	name text	<br>);<br></code></pre></td></tr></table></div></figure><p>查看制定表的结构</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">desc name;<br></code></pre></td></tr></table></div></figure><blockquote><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql2.png" alt="Untitled"></p></blockquote><h2 id="删除表"><a href="#删除表" class="heading-link"><i class="fas fa-link"></i></a><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h2><p>制定一个表</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">use name；<br></code></pre></td></tr></table></div></figure><p>删除表</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">drop table name;// 没有就报错<br>drop table <span class="hljs-keyword">if</span> exists name; // 兼容<br></code></pre></td></tr></table></div></figure><h2 id="修改表"><a href="#修改表" class="heading-link"><i class="fas fa-link"></i></a><a href="#修改表" class="headerlink" title="修改表"></a>修改表</h2><p>修改表名</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">rename table 原始名称 to 新名称;<br>rename table stu to person;<br></code></pre></td></tr></table></div></figure><p>添加字段</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">alter table 表名 add 新增字段名称 类型 [位置];<br>alter table person add age int;// 默认字段放在后面<br>alter table person add score <span class="hljs-built_in">float</span> first; //  first 放到最前面<br>alter table person add phone int after name; // name 后面<br></code></pre></td></tr></table></div></figure><ul><li>alter table person add age int; <img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql3.png" alt="Untitled"></li><li>alter table person add score float first; <img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql4.png" alt="Untitled"></li><li>alter table person add phone int after name; <img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql5.png" alt="Untitled"></li></ul><p>删除字段</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">alter table 表名 drop 字段名称;<br>alter table person drop phone;<br></code></pre></td></tr></table></div></figure><p>修改字段</p><p>1.修改数据类型</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">alter table 表名 modify 需要修改的字段名称 新的数据类型; <br>alter table person modify score double;<br></code></pre></td></tr></table></div></figure><p>2.修改字段名称和数据类型</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">alter table 表名 change 原始字段名称 新字段名称 新的数据类型;<br>alter table person change age address text;<br></code></pre></td></tr></table></div></figure><h2 id="存储引擎"><a href="#存储引擎" class="heading-link"><i class="fas fa-link"></i></a><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h2><p>MySQL中有三种存储引擎，分别是：</p><ul><li>MyISAM：安全性低，但不支持事务和外键，适合频繁插入和查询的应用</li><li>InnoDB(默认）：安全性高，支持事务和外键，适合对安全性，数据完整性要求较高的应用</li><li>Memory：访问速度极快，但不会永久存储数据，适合对读写速度要求较高的应用</li></ul><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">create table stu(<br>    <span class="hljs-built_in">id</span> int,<br>    name text<br>)engine=引擎名称;<br></code></pre></td></tr></table></div></figure><p>不同引擎的本质</p><p>数据库的本质就是文件，只要创建一个数据库，就会创建文件夹</p><p>创建一张表，就会在指定数据库目录创建一个文件，这个文件会保存结构</p><div class="table-container"><table><thead><tr><th>引擎</th><th>内容</th><th>存储文件</th></tr></thead><tbody><tr><td>InnoDB</td><td>创建表就会自动创建一个文件</td><td></td></tr><tr><td>.ibd 保存了这张表的结构</td><td>ibdata1,ibdata2</td><td></td></tr><tr><td>MyISAM</td><td>自动创建三个文件</td><td></td></tr><tr><td>.sdi 表的结构</td><td></td><td></td></tr><tr><td>.MYD 表中存储的数据</td><td></td><td></td></tr><tr><td>.MYI 表中索引</td><td>.MYD文件</td><td></td></tr><tr><td>Memory</td><td>创建.sdi文件，保存结构信息</td><td></td></tr><tr><td>将数据保存在内存中</td><td>内存</td><td></td></tr></tbody></table></div><p>修改表的存储引擎</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">alter table 表明 engine=名称;<br></code></pre></td></tr></table></div></figure><h2 id="插入和更新数据"><a href="#插入和更新数据" class="heading-link"><i class="fas fa-link"></i></a><a href="#插入和更新数据" class="headerlink" title="插入和更新数据"></a>插入和更新数据</h2><p>插入数据</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">INSERT INTO table_name ( field1, field2,...fieldN )<br>                       VALUES<br>                       ( value1, value2,...valueN );<br>// <br>INSERT INTO person ( score,<span class="hljs-built_in">id</span>,name,address )<br>                       VALUES<br>                       ( 1.1,1,<span class="hljs-string">&quot;nihao&quot;</span>,<span class="hljs-string">&quot;china&quot;</span>);<br></code></pre></td></tr></table></div></figure><p>查看数据</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">SELECT column_name,column_name<br>FROM table_name<br>[WHERE Clause]<br>[LIMIT N][ OFFSET M]<br></code></pre></td></tr></table></div></figure><p>更新数据</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">UPDATE table_name SET field1=new-value1, field2=new-value2<br>[WHERE Clause]<br>//<br>// 不指定条件就更新整张表<br>update person <span class="hljs-built_in">set</span> score=2.2323;<br><br>// 指定更新 更新满足条件的<br>update person <span class="hljs-built_in">set</span> score=99.2 <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span>=12;<br><br>// 可以多个条件指定<br>update person <span class="hljs-built_in">set</span> score=99.2 <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span>=12 AND name=<span class="hljs-string">&quot;nihao2&quot;</span>;<br>update person <span class="hljs-built_in">set</span> score=99.2 <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span>=12 OR name=<span class="hljs-string">&quot;nihao&quot;</span>;<br><br>// 更新多个字段<br>update person <span class="hljs-built_in">set</span> score=991.2,address=<span class="hljs-string">&#x27;new address&#x27;</span> <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span>=12 OR name=<span class="hljs-string">&quot;nihao&quot;</span>;<br><br></code></pre></td></tr></table></div></figure><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql6.png" alt="Untitled"></p><h2 id="查询表数据"><a href="#查询表数据" class="heading-link"><i class="fas fa-link"></i></a><a href="#查询表数据" class="headerlink" title="查询表数据"></a>查询表数据</h2><p>全部</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> * from 表名 [<span class="hljs-built_in">where</span>]<br></code></pre></td></tr></table></div></figure><p>指定字段</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> 字段1，字段2 from 表名 [<span class="hljs-built_in">where</span>]<br></code></pre></td></tr></table></div></figure><p>where 支持的运算符</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">=（等于）、！=（不等于）、《〉（不等于）、〈（小于）、〈=（小于等于）、＞（大于）、&gt;=（大于等于）；<br>IN (<span class="hljs-built_in">set</span>)；固定的范围值<br>PETWEEN•••AND：值在什么范围<br>IS NULL：（为空） IS NOT NULL （不为空<br>AND：与<br>OR；或<br>NOT：非<br></code></pre></td></tr></table></div></figure><p>比如</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> * from stu <span class="hljs-built_in">where</span> score <span class="hljs-keyword">in</span> (77, 88)<br></code></pre></td></tr></table></div></figure><h2 id="删除表数据"><a href="#删除表数据" class="heading-link"><i class="fas fa-link"></i></a><a href="#删除表数据" class="headerlink" title="删除表数据"></a>删除表数据</h2><p>删除数据</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">delete from 表名 [<span class="hljs-built_in">where</span> 条件];<br>// <span class="hljs-keyword">select</span> name from person <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span>&gt;5;<br></code></pre></td></tr></table></div></figure><p>删除所有的数据</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">delete from 表名;<br></code></pre></td></tr></table></div></figure><h2 id="Navicat"><a href="#Navicat" class="heading-link"><i class="fas fa-link"></i></a><a href="#Navicat" class="headerlink" title="Navicat"></a>Navicat</h2><p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://www.navicat.com.cn/">Navicat</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><h2 id="数据类型"><a href="#数据类型" class="heading-link"><i class="fas fa-link"></i></a><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p>根据数据类型分配存储空间，正确的数据类型，可以合理分配存储空间，完整保存数据，更好的对数据库进行优化。</p><p>MySQL中有哪些数据类型？</p><h4 id="整型类型"><a href="#整型类型" class="heading-link"><i class="fas fa-link"></i></a><a href="#整型类型" class="headerlink" title="整型类型"></a><strong>整型类型</strong></h4><ol><li>数字分为有符号还是无符号</li><li>超出返回会报错</li><li>默认为有符号 数据类型加上unsigned 变为无符号的</li><li>设置位宽</li></ol><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql7.png" alt="Untitled"></p><p>设置位宽</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">create table person2(<br>    <span class="hljs-built_in">id</span> int,<br>    age tinyint (2) zerofill <br>)<br></code></pre></td></tr></table></div></figure><p>无符号的类型指定</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">create table person2(<br>    <span class="hljs-built_in">id</span> int,<br>    age tinyint unsigned<br>)<br></code></pre></td></tr></table></div></figure><h4 id="浮点类型"><a href="#浮点类型" class="heading-link"><i class="fas fa-link"></i></a><a href="#浮点类型" class="headerlink" title="浮点类型"></a><strong>浮点类型</strong></h4><ul><li>占用空间不一样</li><li>小数的位数不同</li><li>保存数据的有效精度不同</li></ul><p>创建的时候指定小数位数</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">float</span>(m,d)<br>double(m,d)<br>// m 总的位数，d小数位数<br><br>create table person2(<br>    <span class="hljs-built_in">id</span> int,<br>    weight FLOAT (10, 6), height DOUBLE (10, 6)<br>)<br></code></pre></td></tr></table></div></figure><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">// 精度<br>create table person3(<br>    <span class="hljs-built_in">id</span> int,<br>    weight FLOAT (20, 19),<br>    height DOUBLE (20, 19)<br>)<br><br>insert into person3 values (1, 1.12345678901234567890, 1.12345678901234567890);<br><br>weight: 1.1234568357467651000<br><br>height: 1.1234567890123457000<br></code></pre></td></tr></table></div></figure><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql8.png" alt="Untitled"></p><h4 id="定点类型"><a href="#定点类型" class="heading-link"><i class="fas fa-link"></i></a><a href="#定点类型" class="headerlink" title="定点类型"></a><strong>定点类型</strong></h4><p>将数据分为证书和小数部分来存储，每个部分都是整数，精确存储，比较费资源</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">create table person4(<br>    <span class="hljs-built_in">id</span> int,<br>    weight decimal (21,20)<br>    height decimal (21,20)<br>)<br><br>insert into person4 values (1, 1. 12345678901234567890, 1.12345678901234567890);<br></code></pre></td></tr></table></div></figure><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql9.png" alt="Untitled"></p><h4 id="字符类型"><a href="#字符类型" class="heading-link"><i class="fas fa-link"></i></a><a href="#字符类型" class="headerlink" title="字符类型"></a><strong>字符类型</strong></h4><ul><li>保存的数据的容量不一样</li><li>char不会回收多余的字符，要多少给多少</li><li>varchar会回收多余的字符，用多少给多少</li><li>建议使用单引号</li><li>carchar理论可以存储65535字符，但是会随着当前数据库的字符集改变而改变</li><li>字符集utf8 一个字占三个字节，65535/3=21845</li><li>字符集gbk 一个字占两个字节，65535/2=32767</li></ul><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">例如：通过 char(2)存储存储数据’a’，存储的结果是’ a’；<br>例如：通过 varchar(2）存储存储数据’a’，存储的结果是’a；<br></code></pre></td></tr></table></div></figure><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">create table person(<br>    <span class="hljs-built_in">id</span> int,<br>    namel char (2),<br>    name2 varchar (2)<br>)<br><br>insert into person values (1, <span class="hljs-string">&#x27; a&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>);<br>insert into person values (1, <span class="hljs-string">&#x27;12&#x27;</span>,<span class="hljs-string">&#x27;34&#x27;</span>）;<br>insert into person values (1, <span class="hljs-string">&#x27;abc&#x27;</span>,<span class="hljs-string">&#x27;def&#x27;</span>):#只要超出申请的范围就会报错<br></code></pre></td></tr></table></div></figure><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql10.png" alt="Untitled"></p><h4 id="文本类型"><a href="#文本类型" class="heading-link"><i class="fas fa-link"></i></a><a href="#文本类型" class="headerlink" title="文本类型"></a><strong>文本类型</strong></h4><p>mysql中每一行存储的数据大小是有限制的，每一行最多65534字节</p><p>大文本类型 可以突破。大文本类型在表中并不会实际占用所能保存的字节数，而是利用10个字节引用了实际保存数据的地址. 占用的只有十个字节，存的是真实地址。</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql11.png" alt="Untitled"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql12.png" alt="Untitled"></p><h4 id="枚举类型"><a href="#枚举类型" class="heading-link"><i class="fas fa-link"></i></a><a href="#枚举类型" class="headerlink" title="枚举类型"></a><strong>枚举类型</strong></h4><p>如果某个字段值只能取固定的某些值，几个固定值之中的几个</p><p>底层是通过整型来实现的</p><p>和其他的变成语言不通，其他的枚举是从0开始，mysql是从1开始.</p><p>因此也可以通过整数的形式去设置</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">// enum(v1,v2,...)<br>create table person(<br>    <span class="hljs-built_in">id</span> int,<br>    gender enum（<span class="hljs-string">&#x27;男&quot;,&quot;女&#x27;</span>）<br>)<br></code></pre></td></tr></table></div></figure><h4 id="集合类型"><a href="#集合类型" class="heading-link"><i class="fas fa-link"></i></a><a href="#集合类型" class="headerlink" title="集合类型"></a><strong>集合类型</strong></h4><p>几个固定值中的几个</p><p>mysql也是通过整数的形式实现的</p><p>mysql集合类型按照2(n)实现的 方便位运算</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">//  <span class="hljs-built_in">set</span>(v1,v2,v3...)<br>create table person<br> <span class="hljs-built_in">id</span> int,<br> hobby <span class="hljs-built_in">set</span>( <span class="hljs-string">&#x27;篮球&#x27;</span>,<span class="hljs-string">&#x27;足球&#x27;</span>,<span class="hljs-string">&#x27;高尔夫球&#x27;</span>,<span class="hljs-string">&#x27;排球&#x27;</span>）<br>)<br><br>insert into person values (1,<span class="hljs-string">&#x27;篮球,足球,高尔夫球&#x27;</span>)<br></code></pre></td></tr></table></div></figure><h4 id="日期类型"><a href="#日期类型" class="heading-link"><i class="fas fa-link"></i></a><a href="#日期类型" class="headerlink" title="日期类型"></a><strong>日期类型</strong></h4><p>时间需要单引号扩起来</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql13.png" alt="Untitled"></p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">create table person (<br>    <span class="hljs-built_in">id</span> int,<br>    filedl DATE,<br>    filed2 TIME,<br>    filed3 DATETIME<br>)<br>// 报错，时间需要单引号扩起来<br>insert into person values (1, 2020-02-02, 14:18:23, 2020-02-02 14:18:23);<br>// 完美<br>insert into person values (1, <span class="hljs-string">&#x27;2020-02-02&#x27;</span>, <span class="hljs-string">&#x27;14:18:23&#x27;</span>, <span class="hljs-string">&#x27;2020-02-02 14:18:23&#x27;</span>);<br></code></pre></td></tr></table></div></figure><h4 id="布尔类型"><a href="#布尔类型" class="heading-link"><i class="fas fa-link"></i></a><a href="#布尔类型" class="headerlink" title="布尔类型"></a><strong>布尔类型</strong></h4><p>mysql boolean类型也是整型实现的，0假1真，底层本质是mysql是使用c c++实现，所以非0就是真</p><p>boolean 真假</p><p>数值类型</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql14.png" alt="Untitled"></p><h2 id="数据完整性-主键"><a href="#数据完整性-主键" class="heading-link"><i class="fas fa-link"></i></a><a href="#数据完整性-主键" class="headerlink" title="数据完整性-主键"></a>数据完整性-主键</h2><ol><li>什么是数据的完整性<br>保证保存到数据库中的数据都是正确的。</li><li>如何保证数据完整性？<br>数据的完整性可以分为三类：实体完整性、域完整性、参照完整性</li><li>实体完整性<ol><li>什么是实体？<br>表中的一行数据就是一个实体 (entity)</li><li>如何保证实体完整性？<br>保证实体完整性就是保证每一行数据的唯一性</li></ol></li><li>实体完整性的约束类型<ul><li>主键约束 (primary key)</li><li>唯一约束(unique)</li><li>自动增长列 (auto_ increment)</li></ul></li><li>主键约束 (primary key) 主键用于唯一标识表中的每一条数据，和现实生活中的身份证很像<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">create table person (<br>    <span class="hljs-built_in">id</span> int,<br>    name varchar (20)<br>);<br>// 下面的不会报错，但是会有问题，没有唯一性<br>insert into person values (1,<span class="hljs-string">&quot; Inj&quot;</span>);<br>insert into person values (1,<span class="hljs-string">&quot; Inj&quot;</span>);<br></code></pre></td></tr></table></div></figure>有效的<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">create table person (<br>    <span class="hljs-built_in">id</span> int primary key,<br>    name varchar (20)<br>)<br>// 下面的会报错，唯一性问题<br>insert into person values (1,<span class="hljs-string">&quot; Inj&quot;</span>)<br>insert into person values (1,<span class="hljs-string">&quot; Inj&quot;</span>)<br>// 或者<br>create table person (<br>    <span class="hljs-built_in">id</span> int,<br>    name varchar (20),<br>    primary key(<span class="hljs-built_in">id</span>)<br>) ;<br></code></pre></td></tr></table></div></figure>特征如下<ol><li>如果某一个字段设置为主键，那么字段的取值不能重复</li><li>如果设置为主键，不能是nul</li><li>一张表中只能有一个主键，不能出现多个主键</li><li>除了可以在字段的数据类型后添加，还可以通过在最后写上primary key(name)</li></ol></li></ol><h2 id="数据完整性-联合主键"><a href="#数据完整性-联合主键" class="heading-link"><i class="fas fa-link"></i></a><a href="#数据完整性-联合主键" class="headerlink" title="数据完整性-联合主键"></a>数据完整性-联合主键</h2><h3 id="联合主键"><a href="#联合主键" class="heading-link"><i class="fas fa-link"></i></a><a href="#联合主键" class="headerlink" title="联合主键"></a>联合主键</h3><p>我们通过将表中的某个永远不重复的字段设置为主键，从而达到保证每一行数据的唯一性(实体完整性）</p><p>但是在企业开发中有时候我们可能找不到不重复的字段，此时我们还可以通过联合主键的方式来保证每一行数据的唯一性</p><p><strong>联合主键就是同时将多个字段作为一个主键来使用，</strong>多个字段的取值的组合不重复</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">create table person(<br>	name varchar(20),<br>	age int,<br>  primary key(name,age)<br>)<br>insert into person values (<span class="hljs-string">&quot; Inj&quot;</span>,1)<br>insert into person values (<span class="hljs-string">&quot; Inj&quot;</span>,1)<br></code></pre></td></tr></table></div></figure><h2 id="数据完整性-唯一约束"><a href="#数据完整性-唯一约束" class="heading-link"><i class="fas fa-link"></i></a><a href="#数据完整性-唯一约束" class="headerlink" title="数据完整性-唯一约束"></a>数据完整性-唯一约束</h2><p>唯一约束保证某个字段的值永远不重复</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">create table person(<br>	name varchar(20) unique,<br>	age int<br>)<br>insert into person values (<span class="hljs-string">&quot; Inj&quot;</span>,1)<br>insert into person values (<span class="hljs-string">&quot; Inj&quot;</span>,1)<br><br>// 多个unique<br>create table person(<br>	name varchar(20) unique,<br>	age int unique<br>)<br>insert into person values (<span class="hljs-string">&quot; Inj&quot;</span>,1)<br>insert into person values (<span class="hljs-string">&quot; Inj&quot;</span>,1)<br></code></pre></td></tr></table></div></figure><p>唯一约束和主键约束的异同</p><ol><li>同：被约束的字段的取值不能重复</li><li>异：主键在一张表中只有一个，唯一约束可以有多个</li><li>唯一约束可以为空，主键不能为空</li></ol><h2 id="数据完整性-自动增长约束"><a href="#数据完整性-自动增长约束" class="heading-link"><i class="fas fa-link"></i></a><a href="#数据完整性-自动增长约束" class="headerlink" title="数据完整性-自动增长约束"></a>数据完整性-自动增长约束</h2><p>自动增长约束的作用是让某个字段的取值从1开始递增，从而保证实体完整性</p><p>必须是主键才可以自动增长</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> person (<br>    id <span class="hljs-type">int</span> auto_increment <span class="hljs-keyword">primary</span> key,<br>    name <span class="hljs-type">varchar</span> (<span class="hljs-number">20</span>)<br>);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 下面的会报错，唯一性问题<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> person <span class="hljs-keyword">values</span> (<span class="hljs-keyword">null</span>,&quot; Inj&quot;);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> person <span class="hljs-keyword">values</span> (<span class="hljs-keyword">default</span>,&quot; Inj&quot;);<br></code></pre></td></tr></table></div></figure><p>default 或者null 就自动关增长</p><p>在企业开发中如何选择主键呢？最少性和稳定性</p><p>最少性：能用一个字段作为主键，就不要使用多个字段</p><p>稳定性：能用不被操作（修改）的字段作为主键，就不要使用会被操作的字段作为主键</p><p>一般情况会定义id字段，并且字段为整形，自动增长，设置为主键</p><h2 id="实体完整性"><a href="#实体完整性" class="heading-link"><i class="fas fa-link"></i></a><a href="#实体完整性" class="headerlink" title="实体完整性"></a>实体完整性</h2><p>没有这些的时候 添加这些</p><p>如何修改约束</p><p>1.如何修改主键约束</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> 表名 <span class="hljs-keyword">add</span> <span class="hljs-keyword">primary</span> key(字段);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> <br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> person (<br>    id <span class="hljs-type">int</span>,<br>    name <span class="hljs-type">varchar</span> (<span class="hljs-number">20</span>)<br>);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> <br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> person <span class="hljs-keyword">values</span> (<span class="hljs-number">1</span>,&quot; Inj&quot;)<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> person <span class="hljs-keyword">values</span> (<span class="hljs-number">1</span>,&quot; Inj&quot;)<br></code></pre></td></tr></table></div></figure><p>2.如何修改唯一约束</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> 表名 <span class="hljs-keyword">add</span> <span class="hljs-keyword">unique</span>(字段);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> <br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> person2 (<br>    id <span class="hljs-type">int</span>,<br>    name <span class="hljs-type">varchar</span> (<span class="hljs-number">20</span>)<br>);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> <br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> person <span class="hljs-keyword">values</span> (<span class="hljs-number">1</span>,&quot; Inj&quot;)<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> person <span class="hljs-keyword">values</span> (<span class="hljs-number">1</span>,&quot; Inj&quot;)<br></code></pre></td></tr></table></div></figure><p>3.如何修改自动增长约束</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> 表名 <span class="hljs-keyword">add</span> <span class="hljs-keyword">primary</span> key(字段);<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> 表名 modify 字段 数据类型 auto_increment;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> <br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> person2 (<br>    id <span class="hljs-type">int</span>,<br>    name <span class="hljs-type">varchar</span> (<span class="hljs-number">20</span>)<br>);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> <br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> person <span class="hljs-keyword">values</span> (<span class="hljs-keyword">null</span>,&quot; Inj&quot;)<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> person <span class="hljs-keyword">values</span> (<span class="hljs-keyword">default</span>,&quot; Inj&quot;)<br></code></pre></td></tr></table></div></figure><h2 id="域完整性"><a href="#域完整性" class="heading-link"><i class="fas fa-link"></i></a><a href="#域完整性" class="headerlink" title="域完整性"></a>域完整性</h2><p>1.什么是域？</p><p>行数据中的每个单元格都是一个域</p><p>2.如何保证域的完整性？</p><p>保证域的完整性就是保证每个单元格数据的正确性</p><p>使用正确的数据类型</p><p>例如：人的年龄不可能超过255岁，而且不能是负数，所以我们就可以使用 TINYINT UNSIGNED</p><p>例如：人的性别只能是男/女，所以我们就可以使用枚举类型</p><p>例如：要存储比较多的文字，为了保证不超出每一行最大的存储限制，我们就可以使用大文本类型</p><ul><li>使用非空约束 (not null)</li><li>使用默认值约束 (default)</li></ul><p>非空约束</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> person (<br>    id <span class="hljs-type">int</span>,<br>    name <span class="hljs-type">varchar</span> (<span class="hljs-number">20</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span><br>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> person <span class="hljs-keyword">values</span> (<span class="hljs-number">1</span>,&quot; Inj&quot;);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> person <span class="hljs-keyword">values</span> (<span class="hljs-keyword">null</span>,<span class="hljs-keyword">null</span>);<br></code></pre></td></tr></table></div></figure><p>默认值</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> person (<br>    id <span class="hljs-type">int</span>,<br>    name <span class="hljs-type">varchar</span> (<span class="hljs-number">20</span>) <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;这是默认值&#x27;</span><br>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> person <span class="hljs-keyword">values</span> (<span class="hljs-number">1</span>,&quot; Inj&quot;);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> person <span class="hljs-keyword">values</span> (<span class="hljs-keyword">null</span>,<span class="hljs-keyword">null</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> person <span class="hljs-keyword">values</span> (<span class="hljs-keyword">null</span>,<span class="hljs-keyword">default</span>);<br></code></pre></td></tr></table></div></figure><p>注意点null，也不会使用默认值，使用default才会使用</p><h2 id="表与表之间的关系"><a href="#表与表之间的关系" class="heading-link"><i class="fas fa-link"></i></a><a href="#表与表之间的关系" class="headerlink" title="表与表之间的关系"></a>表与表之间的关系</h2><p>1.参照完整性</p><p>参照完整性又称引用完整性，主要用于保证多表之间引用关系的正确性</p><p>2.为什么要创建多张表？</p><p>示例：定义一张表保存2个学生3门课程的成绩</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql15.png" alt="Untitled"></p><p>如果将所有的数据都放到一张表中，会出现大量元余数据(学生信息保存)</p><p>所以为了降低数据库的体积，提升数据库的效率，我们需要根据自身需求对表进行拆分</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql16.png" alt="Untitled"></p><p>3.什么时候会出现冗余数据</p><p>表与表之间的关系可以分为三种 一对一、一对多、多对多</p><p>3.1 一对一</p><p>一般不用拆分</p><div class="table-container"><table><thead><tr><th>id</th><th>name</th><th>gender</th><th>mateId</th></tr></thead><tbody><tr><td>1</td><td>A</td><td>1</td><td>2</td></tr><tr><td>2</td><td>B</td><td>0</td><td>1</td></tr><tr><td>3</td><td>C</td><td>1</td><td>4</td></tr><tr><td>4</td><td>D</td><td>0</td><td>3</td></tr></tbody></table></div><p>3.2 一对多关系</p><p>拆</p><p>一个人有多辆车，一个班有多个学生，一个人有多门成绩</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql17.png" alt="Untitled"></p><p>3.3 多对多关系</p><p>拆</p><p>一个学生有多个老师，一个老师有多个学生</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql18.png" alt="Untitled"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql19.png" alt="Untitled"></p><h2 id="参照完整性"><a href="#参照完整性" class="heading-link"><i class="fas fa-link"></i></a><a href="#参照完整性" class="headerlink" title="参照完整性"></a>参照完整性</h2><ol><li>如何保证参照完整性？</li></ol><p>默认情况下表与表之间是独立存在的，不会相互影响</p><p>也正是因为如此，默认情况下也不会检查表与表之间的依赖关系</p><p>所以为了保证表与表之间参照完整性，我们可以通过’外键’来保证参照完整性</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> stu(<br>	id <span class="hljs-type">int</span> auto_increment <span class="hljs-keyword">primary</span> key,<br>	name <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>),<br>	gender enum(<span class="hljs-string">&#x27;男&#x27;</span>,<span class="hljs-string">&#x27;女&#x27;</span>)<br>)<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> grade(<br>	id <span class="hljs-type">int</span> auto_increment <span class="hljs-keyword">primary</span> key,<br>	km <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>),<br>	score <span class="hljs-keyword">double</span>,<br>	uid <span class="hljs-type">int</span><br>)<br><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> stu <span class="hljs-keyword">values</span> (<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;zs&#x27;</span>,<span class="hljs-string">&#x27;男&#x27;</span>)<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> stu <span class="hljs-keyword">values</span> (<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;ls&#x27;</span>,<span class="hljs-string">&#x27;女&#x27;</span>)<br><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> grade <span class="hljs-keyword">values</span> (<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;语文&#x27;</span>,<span class="hljs-number">100</span>，<span class="hljs-number">1</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> grade <span class="hljs-keyword">values</span> (<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;数学&#x27;</span>,<span class="hljs-number">100</span>，<span class="hljs-number">1</span>);<br></code></pre></td></tr></table></div></figure><ol start="2"><li>什么是外键？</li></ol><p>如果一张表中有一个字段指向了别一张表中的<strong>主键</strong>，就将该字段叫做外键</p><p>例如：成绩表中的uid引用了学生表中的id，那么成绩表中的uid我们就称之为外键</p><p>后面插入数据的时候会进行检查</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- create table stu2(</span><br><span class="hljs-comment">-- 	id int auto_increment primary key,</span><br><span class="hljs-comment">-- 	name varchar(20),</span><br><span class="hljs-comment">-- 	gender enum(&#x27;男&#x27;,&#x27;女&#x27;)</span><br><span class="hljs-comment">-- );</span><br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> grade2(<br>	id <span class="hljs-type">int</span> auto_increment <span class="hljs-keyword">primary</span> key,<br>	km <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>),<br>	score <span class="hljs-keyword">double</span>,<br>	uid <span class="hljs-type">int</span>,<br>  <span class="hljs-keyword">foreign</span> key(uid外键) <span class="hljs-keyword">references</span> stu2(id主键)<br>);<br><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> stu2 <span class="hljs-keyword">values</span> (<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;zs&#x27;</span>,<span class="hljs-string">&#x27;男&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> stu2 <span class="hljs-keyword">values</span> (<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;ls&#x27;</span>,<span class="hljs-string">&#x27;女&#x27;</span>);<br><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> grade2 <span class="hljs-keyword">values</span> (<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;语文&#x27;</span>,<span class="hljs-number">100</span>,<span class="hljs-number">1</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> grade2 <span class="hljs-keyword">values</span> (<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;数学&#x27;</span>,<span class="hljs-number">100</span>,<span class="hljs-number">1</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> grade2 <span class="hljs-keyword">values</span> (<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;语文&#x27;</span>,<span class="hljs-number">100</span>,<span class="hljs-number">2</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> grade2 <span class="hljs-keyword">values</span> (<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;数学&#x27;</span>,<span class="hljs-number">100</span>,<span class="hljs-number">2</span>);<br><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> error<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> grade2 <span class="hljs-keyword">values</span> (<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;数学&#x27;</span>,<span class="hljs-number">100</span>,<span class="hljs-number">3</span>);<br></code></pre></td></tr></table></div></figure><p>3.外键注意点：</p><ul><li>只有InnoDB的存储引擎才支持外键约束</li><li>外键的数据<strong>类型</strong>必须和指向的主键一样</li><li>在一对多的关系中，<strong>外键一般定义在多的一方</strong>(一个学生有多门成绩，那么外键定义在成绩表中）</li><li>定义外键的表我们称之为从表，被外键引用的表我们称之为主表</li></ul><ol start="4"><li>创建表时定义外键</li></ol><p>foreign key(外键字段名称）references 主表名称(主表主键名称)</p><h2 id="参照完整性-1"><a href="#参照完整性-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#参照完整性-1" class="headerlink" title="参照完整性"></a>参照完整性</h2><p>1.如何动态添加外键</p><figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html">alter table 从表名称 add foreign key(外键字段名称） references 主表名称(主表主键名称）;<br><br>create table grade(<br>	id int auto_increment primary key,<br>	km varchar (20),<br>	score double,<br>	uid int<br>);<br>// alter table grade add foreign key(uid) references stu(id);<br>insert into grade values (null,&quot;语文&#x27;,100,3);<br></code></pre></td></tr></table></div></figure><p>2.如何查看外键是谁</p><figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs html">show create table 从表名称;<br>show create table grade<br><br>CREATE TABLE `grade` (<br>  `id` int NOT NULL AUTO_INCREMENT,<br>  `km` varchar(20) DEFAULT NULL,<br>  `score` double DEFAULT NULL,<br>  `uid` int DEFAULT NULL,<br>  PRIMARY KEY (`id`),<br>  KEY `uid` (`uid`),<br>  CONSTRAINT `grade_ibfk_1` FOREIGN KEY (`uid`) REFERENCES `stu` (`id`)<br>) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=gbk<br></code></pre></td></tr></table></div></figure><p>注意点</p><figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html">CONSTRAINT `grade_ibfk_1` FOREIGN KEY (`uid`) REFERENCES `stu` (`id`)<br>- uid变为外键，外键名称为grade_ibfk_1<br>- uid取值引用的是stu表中id字段的值<br></code></pre></td></tr></table></div></figure><p>3.如何动态删除外键</p><figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html">alter table 从表名称 drop foreign key 外键名称;<br>alter table grade drop foreign key grade_ibfk_1;<br></code></pre></td></tr></table></div></figure><h2 id="参照完整性-外键的操作"><a href="#参照完整性-外键的操作" class="heading-link"><i class="fas fa-link"></i></a><a href="#参照完整性-外键的操作" class="headerlink" title="参照完整性 外键的操作"></a>参照完整性 外键的操作</h2><p>1.外键的操作</p><p>严格操作：（前面讲解的都是严格採作）</p><ul><li>主表不存在对应数据，从表不允许添加</li></ul><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx">insert into grade <span class="hljs-title function_">values</span> (<span class="hljs-literal">null</span>,<span class="hljs-string">&quot;语文&#x27;,100,3);</span><br></code></pre></td></tr></table></div></figure><ul><li>从表引用着数据，主表不允许删除</li></ul><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> stu where id=<span class="hljs-number">1</span>;<span class="hljs-comment">// 会失败</span><br></code></pre></td></tr></table></div></figure><ul><li>从表引用这数据，主表不允许修改</li></ul><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx">update stu set id=<span class="hljs-number">3</span> where id=<span class="hljs-number">1</span>;<span class="hljs-comment">// 失败</span><br></code></pre></td></tr></table></div></figure><p>買空操作(null)：</p><ul><li>在企业开发中，我们可能必须要删除主表中的数据，但是如果主表被删除了从表就不完整了所以在企业开发中，我们可以通过置空操作，在删除主表数据的同时删除从表关联的数据</li></ul><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> grade2(<br>	id <span class="hljs-type">int</span> auto_increment primarykey, km <span class="hljs-type">varchar</span> (<span class="hljs-number">20</span>),<br>	score <span class="hljs-keyword">double</span>,<br>	uid <span class="hljs-type">int</span>,<br>	<span class="hljs-keyword">foreign</span> key (uid) <span class="hljs-keyword">references</span> stu (id) <span class="hljs-keyword">on</span> <span class="hljs-keyword">delete</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">null</span><br>)<span class="hljs-operator">/</span><span class="hljs-operator">/</span> 主表删除，从表<span class="hljs-operator">*</span><span class="hljs-operator">*</span>引用置空<span class="hljs-operator">*</span><span class="hljs-operator">*</span>，<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> grade <span class="hljs-keyword">values</span> (<span class="hljs-keyword">null</span>,&quot;语文&#x27;,100,3);<br>update stu set id=3 where id=1;// 失败<br></code></pre></td></tr></table></div></figure><p>级联操作 (cascade)：</p><p>在企业开发中，我们可能必须要修改主表中的数据，但是如果主表被修改了从表就不完整了所以在企业开发中，我们可以通过’级联操作’，在修改主表数据的同时修改从表关联的数据</p><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx">create table <span class="hljs-title function_">grade3</span>(<br>	id int auto_increment primarykey, km <span class="hljs-title function_">varchar</span> (<span class="hljs-number">20</span>),<br>	score double,<br>	uid int,<br>	foreign <span class="hljs-title function_">key</span> (uid) references <span class="hljs-title function_">stu</span> (id) on update cascade<br>)<span class="hljs-comment">// 主表删除，从表引用置空，</span><br>insert into grade3 <span class="hljs-title function_">values</span> (<span class="hljs-literal">null</span>,<span class="hljs-string">&quot;语文&#x27;,100,3);</span><br><span class="hljs-string">delete from stu where id=1; </span><br><span class="hljs-string"></span><br><span class="hljs-string">[constraint 外键名称] foreign key（外键字段）references 主表（主键）[主表删除的动作][主表更新的动作] </span><br><span class="hljs-string">-般情况下主表删除时从表置空，主表更新时从表级联</span><br></code></pre></td></tr></table></div></figure><h2 id="参照完整性-多对多外键"><a href="#参照完整性-多对多外键" class="heading-link"><i class="fas fa-link"></i></a><a href="#参照完整性-多对多外键" class="headerlink" title="参照完整性 多对多外键"></a>参照完整性 多对多外键</h2><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql20.png" alt="Untitled"></p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 创建学生表<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> stu(<br>  id <span class="hljs-type">int</span> auto_increment <span class="hljs-keyword">primary</span> key,<br>  name <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>),<br>  gender enum(<span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-string">&#x27;女&#x27;</span>)<br>);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 创建教师表<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> teacher(<br>  id <span class="hljs-type">int</span> auto_increment <span class="hljs-keyword">primary</span> key,<br>  name <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>),<br>  gender enum(<span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-string">&#x27;女&#x27;</span>)<br>);<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> rel(<br>	stuId <span class="hljs-type">int</span>,<br>	teacherId <span class="hljs-type">int</span><br>)<br><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 添加外键<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> rel <span class="hljs-keyword">add</span> <span class="hljs-keyword">foreign</span> key(stuId) <span class="hljs-keyword">references</span> stu(id)<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> rel <span class="hljs-keyword">add</span> <span class="hljs-keyword">foreign</span> key(teacherId) <span class="hljs-keyword">references</span> teacher(id)<br><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 添加数据<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> stu <span class="hljs-keyword">VALUES</span>(<span class="hljs-keyword">NULL</span>,<span class="hljs-string">&#x27;zhangsan&#x27;</span>,<span class="hljs-string">&#x27;男&#x27;</span>)<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> stu <span class="hljs-keyword">VALUES</span>(<span class="hljs-keyword">NULL</span>,<span class="hljs-string">&#x27;lisi&#x27;</span>,<span class="hljs-string">&#x27;男&#x27;</span>)<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> teacher <span class="hljs-keyword">VALUES</span>(<span class="hljs-keyword">NULL</span>,<span class="hljs-string">&#x27;wangwu&#x27;</span>,<span class="hljs-string">&#x27;男&#x27;</span>)<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> teacher <span class="hljs-keyword">VALUES</span>(<span class="hljs-keyword">NULL</span>,<span class="hljs-string">&#x27;zhaoliu&#x27;</span>,<span class="hljs-string">&#x27;男&#x27;</span>)<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> rel <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>)<span class="hljs-operator">/</span><span class="hljs-operator">/</span> 正常<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> rel <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">2</span>,<span class="hljs-number">12</span>) <span class="hljs-operator">/</span><span class="hljs-operator">/</span> 错误<br><br></code></pre></td></tr></table></div></figure><h2 id="单表查询"><a href="#单表查询" class="heading-link"><i class="fas fa-link"></i></a><a href="#单表查询" class="headerlink" title="单表查询"></a>单表查询</h2><ol><li>单表查询</li></ol><p>seleet * from 表名；#查询表中所有数据</p><p>selpet 字段1，字段2 from 表名：＃查询表中指定宁段数据</p><p>select [* || 字段] from 表名 [where 条件]；#查询表中满足条件的数据</p><p>2.什么是结果集</p><p>通过查询语句查询出来的结果我们就称之为结果集</p><p>结果集以表的形式将查询的结果返回给我们</p><p><strong>注意点：</strong></p><p>结果集返回的表和查询的表不是同一张表</p><p>被查询的表是真实存在的，是存储在磁盘上的</p><p>而结果集不是真实存在的，是存储到内存中的</p><ol start="3"><li>如何给结果集的字段别名</li></ol><p>查询指定字段数据时，我们可以通过as给指定字段取别名</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> name <span class="hljs-keyword">as</span> myName， age <span class="hljs-keyword">as</span> myAge <span class="hljs-keyword">FROM</span> stu；<br></code></pre></td></tr></table></div></figure><p>4.什么是字段表达式？</p><p>查询数据的时候，除了可以查询指定字段的数据以外，我们还可以查询表达式的结果</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-number">6</span><span class="hljs-operator">+</span><span class="hljs-number">6</span>;<br></code></pre></td></tr></table></div></figure><p>5.什么是伪表？</p><p>字段表达式虽然能够查询出表达式的结果，但是不符合MySql的规范</p><p>所以我们可以通过伪表(dual）的方式让字段表达式符合MySQL的规范</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-number">6</span><span class="hljs-operator">+</span><span class="hljs-number">6</span> <span class="hljs-keyword">from</span> dual；<br></code></pre></td></tr></table></div></figure><h2 id="模糊查询"><a href="#模糊查询" class="heading-link"><i class="fas fa-link"></i></a><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h2><p>where</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">where</span>支持的运算符<br><br><span class="hljs-operator">=</span>（等于）、！<span class="hljs-operator">=</span>（不等于）、〈〉（不等于）、〈（小于）、〈<span class="hljs-operator">=</span>（小于等于）、〉（大于）、<span class="hljs-operator">&gt;=</span>（大于等于）；<br><br><span class="hljs-keyword">IN</span> (<span class="hljs-keyword">set</span>)：固定的范围值<br><br>BETVEEN...AND：值在什么范围<br><br><span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>：（为空）<span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>（不为空）<br><br><span class="hljs-keyword">AND</span>；与<br><br><span class="hljs-keyword">OR</span>；或<br><br><span class="hljs-keyword">NOT</span>：非<br><br><span class="hljs-keyword">LIKE</span>： 模糊杳询<br></code></pre></td></tr></table></div></figure><p>通配符</p><p>1.模糊查询格式:</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> 字段 <span class="hljs-keyword">from</span> 表名 <span class="hljs-keyword">where</span> 字段 <span class="hljs-keyword">like</span><span class="hljs-string">&#x27;条件&quot;;</span><br><span class="hljs-string">_ 通配符:表示任意一个字符</span><br><span class="hljs-string">% 通配符:表示任意0～n个字符</span><br><span class="hljs-string"></span><br><span class="hljs-string">a_c:</span><br><span class="hljs-string">abc, adc,( abbc, ac  不行)</span><br><span class="hljs-string"></span><br><span class="hljs-string">_a_c:</span><br><span class="hljs-string">1abc, 3adc （abc1，2abhc不行）</span><br><span class="hljs-string"></span><br><span class="hljs-string">a%c:</span><br><span class="hljs-string">abc, adc, abbc, ac （都行）</span><br><span class="hljs-string"></span><br><span class="hljs-string">%a%c:</span><br><span class="hljs-string">labe, , 2abbc, 3adc （abcl 不行）</span><br></code></pre></td></tr></table></div></figure><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">查询<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> stu <span class="hljs-keyword">WHERE</span> NAME <span class="hljs-keyword">LIKE</span> &quot;lis%&quot;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 也可以 “z_<span class="hljs-operator">%</span>”<br></code></pre></td></tr></table></div></figure><h2 id="单表查询-order-by"><a href="#单表查询-order-by" class="heading-link"><i class="fas fa-link"></i></a><a href="#单表查询-order-by" class="headerlink" title="单表查询 order by"></a>单表查询 order by</h2><p>1.排序 order by</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> 字段 <span class="hljs-keyword">from</span> 表名 <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> 字段 [<span class="hljs-keyword">asc</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">desc</span>];<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-keyword">desc</span> 降序<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-keyword">asc</span> 升序 默认<br><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> stu <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> id <span class="hljs-keyword">DESC</span>,score  <span class="hljs-keyword">asc</span>;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> id 一样，按照score升序<br></code></pre></td></tr></table></div></figure><h2 id="聚合函数"><a href="#聚合函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h2><p>1.统计计算</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-built_in">count</span>() 统计<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> stu<br><br><span class="hljs-built_in">sum</span>() 求和<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">sum</span>(id) <span class="hljs-keyword">from</span> stu<br><br><span class="hljs-built_in">avg</span>()求平均值<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">AVG</span>(id) <span class="hljs-keyword">from</span> stu<br><br><span class="hljs-built_in">max</span>() 获取最大值<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(id) <span class="hljs-keyword">from</span> stu<br><br><span class="hljs-built_in">min</span>()获取最小值<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">min</span>(id) <span class="hljs-keyword">from</span> stu<br></code></pre></td></tr></table></div></figure><p>2.数值类</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">rand()生成随机数 <br><span class="hljs-keyword">select</span> rand() <span class="hljs-keyword">from</span> dual;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> stu <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> rand()<br><br>round()四舍五入<br><span class="hljs-keyword">select</span> round(<span class="hljs-number">1.2</span>) <span class="hljs-keyword">from</span> dual;<br><br><span class="hljs-built_in">ceil</span>() 向上取整<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">ceil</span>(<span class="hljs-number">1.2</span>) <span class="hljs-keyword">from</span> dual;<br><br><span class="hljs-built_in">floor</span>() 向下取整<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">floor</span>(<span class="hljs-number">1.2</span>) <span class="hljs-keyword">from</span> dual;<br><br><span class="hljs-keyword">truncate</span>() 截取小数位<br><span class="hljs-keyword">select</span> <span class="hljs-keyword">truncate</span>(<span class="hljs-number">1.234567</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">from</span> dual;<br></code></pre></td></tr></table></div></figure><p>3.字符串类</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql">ucase()：#转换为大写<br><span class="hljs-keyword">select</span> ucase(<span class="hljs-string">&#x27;hello&#x27;</span>) <span class="hljs-keyword">from</span> dual;<br><br>lcase()；#转换为小写<br><span class="hljs-keyword">select</span> lcase(<span class="hljs-string">&#x27;HELLO&#x27;</span>) <span class="hljs-keyword">from</span> dual; <br><br><span class="hljs-keyword">left</span>()；#从左边指定位置开始截取到<br><span class="hljs-keyword">select</span> <span class="hljs-keyword">left</span>(<span class="hljs-string">&#x27;1234567890&#x27;</span>，<span class="hljs-number">3</span>) <span class="hljs-keyword">from</span> dual; <span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">123</span><br><br><span class="hljs-keyword">right</span>()；#从右边指定位置开始截取<br><span class="hljs-keyword">select</span> <span class="hljs-keyword">right</span>(<span class="hljs-string">&#x27;1234567890&#x27;</span>，<span class="hljs-number">3</span>) <span class="hljs-keyword">from</span> dual; <span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">890</span><br><br><span class="hljs-built_in">substring</span>()；#从指定位置开始截取指定个字符<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">substring</span>(<span class="hljs-string">&#x27;1234567890&#x27;</span>,<span class="hljs-number">3</span>,<span class="hljs-number">5</span>) <span class="hljs-keyword">from</span> dual;<span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-number">34567</span>,第三个开始，截取<span class="hljs-number">5</span>个<br></code></pre></td></tr></table></div></figure><h2 id="数据分组"><a href="#数据分组" class="heading-link"><i class="fas fa-link"></i></a><a href="#数据分组" class="headerlink" title="数据分组"></a>数据分组</h2><ol><li>数据分组 group by</li></ol><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br><span class="hljs-keyword">select</span> 分组字段<span class="hljs-operator">||</span> 聚合函数 <span class="hljs-keyword">from</span> 表名 <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> 分组字段:<br></code></pre></td></tr></table></div></figure><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jsx">统计表中一共有多少stuId<br><span class="hljs-variable constant_">SELECT</span> stuId <span class="hljs-variable constant_">FROM</span> rel<br></code></pre></td></tr></table></div></figure><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql21.png" alt="Untitled"></p><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jsx">统计表中一共有多少stuId，根据stuId分组<br><span class="hljs-variable constant_">SELECT</span> stuId <span class="hljs-variable constant_">FROM</span> rel <span class="hljs-variable constant_">GROUP</span> <span class="hljs-variable constant_">BY</span> stuId<br></code></pre></td></tr></table></div></figure><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql22.png" alt="Untitled"></p><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jsx">每个id有多少人<br><span class="hljs-variable constant_">SELECT</span> stuId,<span class="hljs-title function_">COUNT</span>(*) <span class="hljs-variable constant_">FROM</span> rel <span class="hljs-variable constant_">GROUP</span> <span class="hljs-variable constant_">BY</span> stuId<br></code></pre></td></tr></table></div></figure><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql23.png" alt="Untitled"></p><p>注意点</p><ol><li>在对数据进行分组的时候，select 后面必须是分组字段或者聚合函数，否则就只会返回第一条数据</li></ol><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx">elect city <span class="hljs-keyword">from</span> stu group by city;<br><br>select name <span class="hljs-keyword">from</span> stu group by city;<br><br>select city, <span class="hljs-title function_">group_concat</span>(name) <span class="hljs-keyword">from</span> stu group by city;<br></code></pre></td></tr></table></div></figure><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql24.png" alt="Untitled"></p><h2 id="条件查询-having"><a href="#条件查询-having" class="heading-link"><i class="fas fa-link"></i></a><a href="#条件查询-having" class="headerlink" title="条件查询 having"></a>条件查询 having</h2><p>having和where很像都是用来做条件查询的</p><p>但是where是去<strong>数据库</strong>中查询符合条件的数据，而having是去<strong>结果集</strong>中查询符合条件的数据</p><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx">select * <span class="hljs-keyword">from</span> stu where id=<span class="hljs-number">1</span><br><span class="hljs-comment">// 从数据库查找</span><br><br>select name <span class="hljs-keyword">from</span> stu where id=<span class="hljs-number">1</span><span class="hljs-comment">// 有结果</span><br></code></pre></td></tr></table></div></figure><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx">select * <span class="hljs-keyword">from</span> stu having id=<span class="hljs-number">1</span><br><span class="hljs-comment">// 从select * from stu 的结果集查找</span><br><br>select name <span class="hljs-keyword">from</span> stu having id=<span class="hljs-number">1</span><span class="hljs-comment">// 没有结果</span><br></code></pre></td></tr></table></div></figure><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx">需求:select city <span class="hljs-keyword">from</span> stu group by <span class="hljs-attr">city</span>:<br><br>需求:select city, <span class="hljs-title function_">avg</span> (score) <span class="hljs-keyword">from</span> stu group by city;<br><br>需求:select city, <span class="hljs-title function_">avg</span> (score) <span class="hljs-keyword">as</span> average <span class="hljs-keyword">from</span> stu group by city;<br><br>需求:select city, <span class="hljs-title function_">avg</span> (score) <span class="hljs-keyword">as</span> average <span class="hljs-keyword">from</span> stu group by city having average&gt;=<span class="hljs-number">60</span><br></code></pre></td></tr></table></div></figure><h2 id="数据分页"><a href="#数据分页" class="heading-link"><i class="fas fa-link"></i></a><a href="#数据分页" class="headerlink" title="数据分页"></a>数据分页</h2><p>1.分页 limit:</p><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx">select 字段 <span class="hljs-keyword">from</span> 表 limit 索引,个数;<br></code></pre></td></tr></table></div></figure><h2 id="查询选项"><a href="#查询选项" class="heading-link"><i class="fas fa-link"></i></a><a href="#查询选项" class="headerlink" title="查询选项"></a>查询选项</h2><p>select[查询选项]字段名称 from 表名：</p><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx">select [查询选项] 字段名称 <span class="hljs-keyword">from</span> 表名：<br>all  显示所有查询出来的数据[默认] <br>distinct  去除结果集中重复的数据之后再显示<br></code></pre></td></tr></table></div></figure><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jsx">select all stuId <span class="hljs-keyword">from</span> rel<br>select distinct stuId <span class="hljs-keyword">from</span> rel<br></code></pre></td></tr></table></div></figure><p>注意</p><p>如果是通过distinct来对结果集中重复的数据进行去重，那么只有所有列的数据都相同才会去重</p><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx">select distinct * <span class="hljs-keyword">from</span> rel <span class="hljs-comment">// 全部</span><br>select distinct stuId <span class="hljs-keyword">from</span> rel <span class="hljs-comment">// stuId 去重</span><br><br></code></pre></td></tr></table></div></figure><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx">完整的查询语句<br><br>select[查询选项]宁段名称 [<span class="hljs-keyword">from</span> 表名〕[where 条件〕 <span class="hljs-title class_">Lorder</span> by 排序〕[group by 分组]<br>[having 条件] [limit分页]<br></code></pre></td></tr></table></div></figure><h2 id="多表查询"><a href="#多表查询" class="heading-link"><i class="fas fa-link"></i></a><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h2><p>1.多表查询</p><p>多表查询只需要在单表查询基础上增加一张表即可</p><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx">select * <span class="hljs-keyword">from</span> 表名<span class="hljs-number">1</span>，表名<span class="hljs-number">2</span>；<br></code></pre></td></tr></table></div></figure><p>注意点：</p><p>默认情况下多表查询的结果是笛卡尔集</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql25.png" alt="Untitled"></p><p>2.union</p><p>在纵向上将多张表的结果结合起来返回给我们</p><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx">select * <span class="hljs-keyword">from</span> 表名<span class="hljs-number">1</span> union select * <span class="hljs-keyword">from</span> 表名<span class="hljs-number">2</span><br></code></pre></td></tr></table></div></figure><p>注意</p><ol><li>使用union进行多表查询，返回的结果集的表头的名称是第一张表的名称</li><li>使用union进行多表查询，必须保证多张表查询的字段个数一致</li><li>使用union进行多表查询，默认情况下会自动去重</li><li>使用union进行多表查询，如果不想自动去重，那么可以在union后面加上all</li></ol><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jsx">select * <span class="hljs-keyword">from</span> 表名<span class="hljs-number">1</span> union all select * <span class="hljs-keyword">from</span> 表名<span class="hljs-number">2</span><br><span class="hljs-comment">// 不去重</span><br></code></pre></td></tr></table></div></figure><h2 id="表的连接"><a href="#表的连接" class="heading-link"><i class="fas fa-link"></i></a><a href="#表的连接" class="headerlink" title="表的连接"></a>表的连接</h2><p>1.表的连接查询</p><p>将多张表中’关联的字段’’连接’在一起查询我们称之为’表的连接查询’</p><p>大白话：查询多张表中满足条件的数据</p><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx">select * <span class="hljs-keyword">from</span> stu, grade where stu.<span class="hljs-property">id</span> = grade. <span class="hljs-attr">stuld</span>:<br></code></pre></td></tr></table></div></figure><p>1.1内连接 inner join</p><p>在内连接中只会返回满足条件的数据</p><p>在进行多表查询的时候，如果想查询指定的字段，那么必须在字段名称前面加上表名才行</p><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx">select * <span class="hljs-keyword">from</span> 表名<span class="hljs-number">1</span> inner join 表名<span class="hljs-number">2</span> on 条件;<br>select * <span class="hljs-keyword">from</span> stu inner join grade on stu. id = grade. stuld;<br>select stu.<span class="hljs-property">id</span>,stu.<span class="hljs-property">name</span>,grade.<span class="hljs-property">score</span> <span class="hljs-keyword">from</span> stu inner join grade on stu. id = grade. stuld;<br></code></pre></td></tr></table></div></figure><p>1.2外连接</p><p>1.2.1左外连接 left join</p><p>在左外连接中，左边的表是不看条件的，无论条件是否满足，都会返回左边表中所有的数据</p><p>在左外连接中，只有右边的表会看条件，对于右边的表而言，只有满足条件才会返回对应的数据</p><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx">#select stu.<span class="hljs-property">id</span>, stu.<span class="hljs-property">name</span>, grade. score <span class="hljs-keyword">from</span> stu left join grade on stu.<span class="hljs-property">id</span>=grade.<span class="hljs-property">stuld</span>:<br>在以上的查询语句中stu表在左边，grade表在右边 <br>所以stu表不看条件，只有grade表看条件<br></code></pre></td></tr></table></div></figure><p>1.2.2右外连接 right join</p><p>在右外连接中，左边的表是不看条件的，无论条件是否满足，都会返回左边表中所有的数据</p><p>在右外连接中，只有左边的表会看条件，对于左边的表而言，只有满足条件才会返回对应的数据 /</p><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx">#select stu。 id， stu。 name， grade。 score <span class="hljs-keyword">from</span> stu right join grade on stu。 id = grade。 stuld；<br>在以上的查询语句中stu表在左边，grade表在右边<br><br>所以stu表看条件，只有grade表不看条件<br></code></pre></td></tr></table></div></figure><p>1.3交叉连接 Cross join</p><p>如果没有指定条件，那么返回笛卡尔集</p><p>如果指定了条件，那么就等价于内连接</p><p>1.4全连接 full join (MySQL不支持全连接）</p><h2 id="自然连接"><a href="#自然连接" class="heading-link"><i class="fas fa-link"></i></a><a href="#自然连接" class="headerlink" title="自然连接"></a>自然连接</h2><p>1.自然连接 (natural)</p><p>自然连接是用来简化’内连接和外连接’的</p><p>如果多张表需要判断的条件字段名称一致，那么不用编写条件，自然连接会自动判断</p><p>1.1自然内连接</p><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx">select * <span class="hljs-keyword">from</span> 表名<span class="hljs-number">1</span> inner join 表名<span class="hljs-number">2</span> on 条件;<br>select * <span class="hljs-keyword">from</span> stu inner join grade on stu.<span class="hljs-property">id</span>=grade.<span class="hljs-property">stuId</span>;<br>stu 改为 stuId<br>select * <span class="hljs-keyword">from</span> stu naturl join grade;<br></code></pre></td></tr></table></div></figure><p>注意</p><ol><li>如果没有指定条件，也没有同名的字段，那么就会返回笛卡尔集</li><li>在自然连接中，返回的结果集会自动优化，会自动去除重复的判断字段</li></ol><p>1.2自然外连接</p><p>1.2.1自然左外连接</p><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx">select * <span class="hljs-keyword">from</span> stu naturl left join grade;<br></code></pre></td></tr></table></div></figure><p>1.2.1自然右外连接</p><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx">select * <span class="hljs-keyword">from</span> stu naturl right join grade;<br></code></pre></td></tr></table></div></figure><h2 id="using关键字"><a href="#using关键字" class="heading-link"><i class="fas fa-link"></i></a><a href="#using关键字" class="headerlink" title="using关键字"></a>using关键字</h2><p>using关键字</p><p>如果多张表需要判断的条件字段名称一致,那么除了可以使用自然连接来简化以外还可以使用using关键字来简化</p><p>1.1内连接</p><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jsx">select * <span class="hljs-keyword">from</span> stu inner join grade on stu. stuld = grade. stuld;<br>select * <span class="hljs-keyword">from</span> stu inner join grade <span class="hljs-title function_">using</span>(stuld)<br></code></pre></td></tr></table></div></figure><p>1.2外连接</p><p>1.2.1左外连接</p><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx">select * <span class="hljs-keyword">from</span> stu left join grade   <span class="hljs-title function_">using</span>(stuld)<br></code></pre></td></tr></table></div></figure><p>1.2.2右外连接</p><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx">select * <span class="hljs-keyword">from</span> stu right join grade  <span class="hljs-title function_">using</span>(stuld)<br></code></pre></td></tr></table></div></figure><h2 id="子查询"><a href="#子查询" class="heading-link"><i class="fas fa-link"></i></a><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h2><p>1.子查询</p><p>将一个查询语句查询的结果作为另一个查询语句的条件来使用</p><p>将一个查询语句查询的结果作为另一个查询语句的表来使用</p><p>2。将一个查询语句查询的结果作为另一个查询的条件来使用</p><p>2.1标准子查询（返回的结果只有一个）</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> stuId <span class="hljs-keyword">from</span> grade <span class="hljs-keyword">where</span> score <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;<span class="hljs-operator">/</span><span class="hljs-operator">/</span> stuld <span class="hljs-number">3</span><br><span class="hljs-keyword">select</span> name <span class="hljs-keyword">from</span> stu <span class="hljs-keyword">where</span> stuld <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;<br><br><span class="hljs-keyword">select</span> name <span class="hljs-keyword">from</span> stu <span class="hljs-keyword">where</span> stuId <span class="hljs-operator">=</span> (<span class="hljs-keyword">select</span> stuId <span class="hljs-keyword">from</span> grade <span class="hljs-keyword">where</span> score <span class="hljs-operator">=</span> <span class="hljs-number">100</span>);<br></code></pre></td></tr></table></div></figure><p>2.2非标准子查询（返回的结果有多个）</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> stuId frpm grade <span class="hljs-keyword">where</span> score ＞<span class="hljs-operator">=</span> <span class="hljs-number">60</span>; <span class="hljs-operator">/</span><span class="hljs-operator">/</span> stuId <span class="hljs-number">1</span> <span class="hljs-number">3</span> <br><span class="hljs-keyword">select</span> name <span class="hljs-keyword">from</span> stu <span class="hljs-keyword">where</span> stuld <span class="hljs-operator">=</span> <span class="hljs-number">3</span> <span class="hljs-keyword">OR</span> stuld <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><span class="hljs-keyword">select</span> name <span class="hljs-keyword">from</span> stu <span class="hljs-keyword">where</span> stuld <span class="hljs-keyword">in</span>(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>);<br><br>seleet name <span class="hljs-keyword">from</span> stu <span class="hljs-keyword">where</span> stuld <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> stuld <span class="hljs-keyword">from</span> grade <span class="hljs-keyword">where</span> score <span class="hljs-operator">&gt;=</span> <span class="hljs-number">60</span>)<br><br></code></pre></td></tr></table></div></figure><p>3。 将一个查询语句查询的结果作为另一个查询的表来使用</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> name, city, score <span class="hljs-keyword">from</span> person <span class="hljs-keyword">where</span> score <span class="hljs-operator">&gt;=</span> <span class="hljs-number">60</span>:<br><br>seleet name, city, score <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> name, city, score <span class="hljs-keyword">from</span> person <span class="hljs-keyword">where</span> score<span class="hljs-operator">&gt;</span><span class="hljs-number">60</span>) <span class="hljs-keyword">as</span> temp;<br><br></code></pre></td></tr></table></div></figure><p>注意点：</p><p>如果要将一个查询语句查询的结果作为另一个查询的表来使用，那么必须给子查询起一个别名</p><h2 id="事务介绍"><a href="#事务介绍" class="heading-link"><i class="fas fa-link"></i></a><a href="#事务介绍" class="headerlink" title="事务介绍"></a>事务介绍</h2><p>银行表</p><div class="table-container"><table><thead><tr><th>cardId</th><th>name</th><th>money</th></tr></thead><tbody><tr><td>1001</td><td>zs</td><td>1000</td></tr><tr><td>1002</td><td>ls</td><td>1000</td></tr></tbody></table></div><p>ls给zs转账1000</p><p>第一种情况：</p><p>1。首先从ls的卡上扣除1000块钱</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">update</span> bank <span class="hljs-keyword">set</span> money <span class="hljs-operator">=</span> money <span class="hljs-operator">-</span> <span class="hljs-number">1000</span> <span class="hljs-keyword">where</span> carld<span class="hljs-operator">=</span><span class="hljs-number">1002</span><br></code></pre></td></tr></table></div></figure><p>2。然后再给zs的卡上增加1000块钱</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">update</span> bank <span class="hljs-keyword">set</span> money <span class="hljs-operator">=</span> money <span class="hljs-operator">+</span> <span class="hljs-number">1000</span> <span class="hljs-keyword">where</span> carld<span class="hljs-operator">=</span><span class="hljs-number">1001</span><br></code></pre></td></tr></table></div></figure><p>第二种情况：</p><p>1。首先给zs的卡上增加1000块钱</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">update</span> bank <span class="hljs-keyword">set</span> money <span class="hljs-operator">=</span> money <span class="hljs-operator">+</span> <span class="hljs-number">1000</span> <span class="hljs-keyword">where</span> carld<span class="hljs-operator">=</span><span class="hljs-number">1001</span><br></code></pre></td></tr></table></div></figure><p>2。然后再从Is的卡上扣除1000块钱</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">update</span> bank <span class="hljs-keyword">set</span> money <span class="hljs-operator">=</span> money <span class="hljs-operator">-</span> <span class="hljs-number">1000</span> <span class="hljs-keyword">where</span> carld<span class="hljs-operator">=</span><span class="hljs-number">1002</span><br></code></pre></td></tr></table></div></figure><p>如果停电了怎么半？会中断</p><p>1.事务基木概念</p><p>MySQL中的事务主要用于处理容易出错的数据。</p><p>事务可以用来维护数据库的完整性，保证成批的 SQL语句要么全部热行，要么全部不执行。</p><p>事务用来管理 insert， update， delete 语句</p><p>MySQL中只有使用了 Innodb 数据库引擎的表才支持事务。</p><h2 id="事务原理和使用"><a href="#事务原理和使用" class="heading-link"><i class="fas fa-link"></i></a><a href="#事务原理和使用" class="headerlink" title="事务原理和使用"></a>事务原理和使用</h2><p>事物语法</p><p>开启事务:start transaction</p><p>提交事务:commit</p><p>回滚事务:rollback</p><p>3.示例一:</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> bank(<br>	id <span class="hljs-type">int</span> unsigned auto_ increment <span class="hljs-keyword">primary</span> key,<br>	candid <span class="hljs-type">varchar</span> (<span class="hljs-number">4</span>),<br>	name <span class="hljs-type">varchar</span> (<span class="hljs-number">20</span>),<br>	money <span class="hljs-type">int</span><br>)<br><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> bank <span class="hljs-keyword">values</span> (<span class="hljs-keyword">null</span>, <span class="hljs-number">1001</span> Zs <span class="hljs-number">1000</span>),(<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;1002&#x27;</span>,<span class="hljs-string">&#x27;ls&#x27;</span>,<span class="hljs-number">1000</span>)s<br></code></pre></td></tr></table></div></figure><p>第一种:先扣再增加</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">update</span> bank <span class="hljs-keyword">set</span> money<span class="hljs-operator">=</span>money<span class="hljs-number">-1000</span> <span class="hljs-keyword">where</span> cardid<span class="hljs-operator">=</span><span class="hljs-string">&#x27; 1002&#x27;</span> <br><span class="hljs-keyword">update</span> bank <span class="hljs-keyword">set</span> money<span class="hljs-operator">=</span>money<span class="hljs-operator">+</span><span class="hljs-number">1000</span> <span class="hljs-keyword">where</span> cardid<span class="hljs-operator">=</span><span class="hljs-string">&#x27; 1001&#x27;</span><br></code></pre></td></tr></table></div></figure><p>第二种:先增加再扣</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">update</span> bank <span class="hljs-keyword">set</span> money<span class="hljs-operator">=</span>money<span class="hljs-operator">+</span><span class="hljs-number">1000</span> <span class="hljs-keyword">where</span> cardid<span class="hljs-operator">=</span><span class="hljs-string">&#x27;1001&#x27;</span> <br><span class="hljs-keyword">update</span> bank <span class="hljs-keyword">set</span> money<span class="hljs-operator">=</span>money<span class="hljs-number">-1000</span> <span class="hljs-keyword">where</span> cardid<span class="hljs-operator">=</span><span class="hljs-string">&#x27;1002&#x27;</span><br></code></pre></td></tr></table></div></figure><p>使用事物</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">start</span> transaction:<br><span class="hljs-keyword">update</span> bank <span class="hljs-keyword">set</span> money<span class="hljs-operator">=</span>money<span class="hljs-number">-1000</span> <span class="hljs-keyword">where</span> cardid<span class="hljs-operator">-</span><span class="hljs-string">&#x27; 1002&#x27;</span> <br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> collback<br><span class="hljs-keyword">update</span> bank <span class="hljs-keyword">set</span> money<span class="hljs-operator">=</span>money<span class="hljs-operator">+</span><span class="hljs-number">1000</span> <span class="hljs-keyword">where</span> cardid<span class="hljs-operator">-</span><span class="hljs-string">&#x27; 1001&#x27;</span><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-keyword">commit</span><br></code></pre></td></tr></table></div></figure><p>注意点：</p><p>事务的本质是开启事务的时候拷贝一张一模一样的表</p><p>然后执行相关的操作都是在拷贝的这张表中做操作</p><p>如果失败了，如果执行了rollback，那么系统就会自动删除拷贝的这张表</p><p>所以失败了不会影响到原有的数据</p><p>如果成功了，如果扒行了comnit，那么系统就会自动利用拷贝表中最新的数据後盖原有表中的数据所以成功了会影响到原有的数据</p><h2 id="事务回滚点"><a href="#事务回滚点" class="heading-link"><i class="fas fa-link"></i></a><a href="#事务回滚点" class="headerlink" title="事务回滚点"></a>事务回滚点</h2><p>事务回滚点</p><p><strong>记住需要commit</strong></p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">savepoint</span> 回滚点名称 <br><br><span class="hljs-keyword">rollback</span> <span class="hljs-keyword">to</span> 回滚点名称<br></code></pre></td></tr></table></div></figure><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">start</span> transaction;<br><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> bank <span class="hljs-keyword">values</span> (<span class="hljs-keyword">null</span>, <span class="hljs-number">1003</span> <span class="hljs-string">&#x27;333&#x27;</span>, <span class="hljs-number">33333</span>):<br><br><span class="hljs-keyword">savepoint</span> abc;<br><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> bank <span class="hljs-keyword">values</span> (<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;1003&#x27;</span>,<span class="hljs-string">&#x27;444&#x27;</span>, <span class="hljs-number">44444</span>);<br><br><span class="hljs-keyword">Savepoint</span> def:<br><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> bank <span class="hljs-keyword">values</span> (<span class="hljs-keyword">null</span>, <span class="hljs-number">1003</span>,<span class="hljs-string">&#x27;555&#x27;</span>,<span class="hljs-number">55555</span>):<br></code></pre></td></tr></table></div></figure><h2 id="事务特点"><a href="#事务特点" class="heading-link"><i class="fas fa-link"></i></a><a href="#事务特点" class="headerlink" title="事务特点"></a>事务特点</h2><p>事务特点：</p><p>1.原子性（关注的是状态）：</p><p>事务开启后的所有操作，要么全部成功，要么全部失败，不可能出现部分成功的情况事务扒行过程中如果出错，哪怕我们不手动回滚，系统也会自动帮我们回滚</p><p>2.一致性（关注数据可见性）：</p><p>事务开始前和结束后，数据库的完整性约束没有被破坏</p><p>例如 A向B转账，不可能A扣了钱，B却没收到</p><p>3.持久性：</p><p>事务完成后，事务对数据库的所有操作是永久的，操作完成之后就不能再回滚</p><p>4.隔离性：</p><p>数据库允许多个并发事务同时对其数据进行读写和修改的能力， 隔离性可以防止多个事务并发执行时由于交叉执行而导致数据的不一致。</p><h2 id="事务隔离级别"><a href="#事务隔离级别" class="heading-link"><i class="fas fa-link"></i></a><a href="#事务隔离级别" class="headerlink" title="事务隔离级别"></a>事务隔离级别</h2><p>1.事务隔离级别</p><p>读未提交(read uncommitted):一个事务可以读取另一个未提交事务的数据</p><p>读提交(read committed):一个事务要等另一个事务提交后才能读取数据</p><p>可重复读(repeatable read）:一个事务范围内多个相同的查询返回相同的结果</p><p>申行化(serializable）:前面一个事务没有执行完后面一个事务不能执行</p><p>查看隔离级别:</p><p>全局的:select @@global. transaction_ isolation;</p><p>当前会话的:select @@transaction_ isolation:</p><p>设置隔离级别:</p><p>全局的:set global transaction isolation level 级别名称;</p><p>当前会话:set session transaction isolation level 级别名称:</p><h4 id="脏读"><a href="#脏读" class="heading-link"><i class="fas fa-link"></i></a><a href="#脏读" class="headerlink" title="脏读"></a>脏读</h4><p>能读取到其它事务没有提交的数据示例:</p><p>A客户端:</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">set</span> session transaction isolation level read uncommitted:<br><br><span class="hljs-keyword">start</span> transaction:<br><br><span class="hljs-keyword">update</span> bank <span class="hljs-keyword">set</span> money<span class="hljs-operator">=</span>money<span class="hljs-number">-1000</span> <span class="hljs-keyword">where</span> cardId<span class="hljs-operator">=</span><span class="hljs-string">&#x27; 1002&#x27;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> bank;<br></code></pre></td></tr></table></div></figure><p>B客户端:</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">set</span> sessioll transaction isolation level read uncommitted;<br><br><span class="hljs-keyword">select</span> 米 fron bank:<br></code></pre></td></tr></table></div></figure><p><strong>解决办法：读提交 read committed</strong></p><h4 id="不可重复读"><a href="#不可重复读" class="heading-link"><i class="fas fa-link"></i></a><a href="#不可重复读" class="headerlink" title="不可重复读"></a>不可重复读</h4><p>一个事务范围内多次查询的结果不同示例:</p><p>A客户端:</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">set</span> session transaction isolation level read committed;<br><br><span class="hljs-keyword">start</span> transaction;<br><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> bank:<br></code></pre></td></tr></table></div></figure><p>B客户端:</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">set</span> session transaction isolation level read committed;<br><br><span class="hljs-keyword">start</span> transaction;<br><br><span class="hljs-keyword">update</span> bank <span class="hljs-keyword">set</span> money<span class="hljs-operator">=</span>money<span class="hljs-number">-1000</span> <span class="hljs-keyword">where</span> cardld<span class="hljs-operator">=</span> <span class="hljs-number">1002</span> <span class="hljs-keyword">commit</span>:<br></code></pre></td></tr></table></div></figure><p><strong>解决办法：可重复读</strong></p><h4 id="重复读"><a href="#重复读" class="heading-link"><i class="fas fa-link"></i></a><a href="#重复读" class="headerlink" title="重复读"></a>重复读</h4><p>一个事务范围内多次查询的结果相同 A客户端:</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">set</span> session transaction isolation level repeatable read:<br><br><span class="hljs-keyword">start</span> transaction:<br><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> bank:<br></code></pre></td></tr></table></div></figure><p>B客户端:</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">set</span> session transaction isolation level repeatable read;<br><br><span class="hljs-keyword">start</span> transaction;<br><br><span class="hljs-keyword">update</span> bank <span class="hljs-keyword">set</span> money<span class="hljs-operator">=</span>money<span class="hljs-number">-1000</span> <span class="hljs-keyword">where</span> cardid<span class="hljs-operator">=</span><span class="hljs-string">&#x27; 1002&#x27;</span> <span class="hljs-keyword">commit</span>:<br></code></pre></td></tr></table></div></figure><p>幻读的问题，改为串行化</p><h4 id="串行化"><a href="#串行化" class="heading-link"><i class="fas fa-link"></i></a><a href="#串行化" class="headerlink" title="串行化"></a>串行化</h4><p>保证永远的都是这个正确的，但是性能比较低</p><p>幻读</p><p>读到到的结果并不是最终的结果</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">set</span> session transaction isolation level serializable;<br><br><span class="hljs-keyword">start</span> transaction:<br><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> bank:<br></code></pre></td></tr></table></div></figure><p>B客户端:</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">set</span> session transaction isolation level serializable;<br><br><span class="hljs-keyword">start</span> transaction:<br><br><span class="hljs-keyword">update</span> bank <span class="hljs-keyword">set</span> money<span class="hljs-operator">=</span>money<span class="hljs-number">-1000</span> <span class="hljs-keyword">where</span> cardid<span class="hljs-operator">=</span> <span class="hljs-string">&#x27;1002&#x27;</span> <span class="hljs-keyword">commit</span>;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 会卡在这里<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-keyword">update</span> bank <span class="hljs-keyword">set</span> money<span class="hljs-operator">=</span>money<span class="hljs-number">-1000</span> <span class="hljs-keyword">where</span> cardid<span class="hljs-operator">=</span> <span class="hljs-string">&#x27;1002&#x27;</span> <span class="hljs-keyword">commit</span>;<br></code></pre></td></tr></table></div></figure><p>事务隔离级别对应关系</p><div class="table-container"><table><thead><tr><th>事务隔离级别</th><th>脏读</th><th>不可重复读</th><th>幻读</th></tr></thead><tbody><tr><td>读未提交</td><td>是</td><td>是</td><td>是</td></tr><tr><td>不可重复读</td><td>否</td><td>是</td><td>是</td></tr><tr><td>可重复读</td><td>否</td><td>否</td><td>是</td></tr><tr><td>串行化</td><td>否</td><td>否</td><td>否</td></tr></tbody></table></div><h2 id="视图基本概念"><a href="#视图基本概念" class="heading-link"><i class="fas fa-link"></i></a><a href="#视图基本概念" class="headerlink" title="视图基本概念"></a>视图基本概念</h2><p>1.视图基本概念</p><p>视图本质就是将结果集缓存起来</p><p>由于结果集是一张虚拟的表，所以视图也是一张虚拟的表由于结果集是建立在表的基础上的，所以视图也是建立在表的基础上的</p><p>2.视图的作用：</p><p>视图可以用来简化SQL语句</p><p>视图可以用来隐藏表的结构</p><p>视图可以用来提升数据安全性</p><p>3.创建视图语法</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">view</span> 视图名称 <span class="hljs-keyword">as</span> <span class="hljs-keyword">select</span> 语句；<br><br><span class="hljs-keyword">SELECT</span> name, city <span class="hljs-keyword">FROM</span> person <span class="hljs-keyword">WHERE</span> score <span class="hljs-operator">&gt;=</span> <span class="hljs-number">60</span>;<br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> person_view <span class="hljs-keyword">AS</span> <span class="hljs-keyword">SELECT</span> name, city <span class="hljs-keyword">FROM</span> person <span class="hljs-keyword">WHERE</span> score <span class="hljs-operator">&gt;=</span> <span class="hljs-number">60</span>;<br><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> person_view<br><br></code></pre></td></tr></table></div></figure><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> name, score <span class="hljs-keyword">FROM</span> Stu <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> grade <span class="hljs-keyword">on</span> stu.stuld <span class="hljs-operator">=</span> grade.stuId;<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">view</span> stu_view <span class="hljs-keyword">as</span> <span class="hljs-keyword">SELECT</span> name, score <span class="hljs-keyword">FROM</span> Stu <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> grade <span class="hljs-keyword">on</span> stu.stuld <span class="hljs-operator">=</span> grade.stuId;<br></code></pre></td></tr></table></div></figure><h2 id="视图基本操作"><a href="#视图基本操作" class="heading-link"><i class="fas fa-link"></i></a><a href="#视图基本操作" class="headerlink" title="视图基本操作"></a>视图基本操作</h2><p>1.视图数据操作</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> person_view <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;it&#x27;</span>,<span class="hljs-string">&#x27;武汉&#x27;</span>）;<br></code></pre></td></tr></table></div></figure><p>注意点：</p><p>由于视图保存的是结果集，由于结果集是基于原始表的所以操作视图中的数据，本质上操作的是原始表中的数据，在原来的数据里面也会看到</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> person <span class="hljs-keyword">view</span>;<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> person <span class="hljs-keyword">view</span> <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;it666&#x27;</span>,<span class="hljs-string">&#x27;武汉&#x27;</span>）;<br><br><span class="hljs-keyword">UPDATE</span> person <span class="hljs-keyword">View</span> <span class="hljs-keyword">set</span> city<span class="hljs-operator">=</span><span class="hljs-string">&#x27;香港&#x27;</span> name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;it666&#x27;</span>:<br><br><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> person <span class="hljs-keyword">view</span> <span class="hljs-keyword">WHERE</span> name<span class="hljs-operator">=</span><span class="hljs-string">&#x27; it666&#x27;</span>;<br></code></pre></td></tr></table></div></figure><p>2.修改视图内容</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">view</span> 视图名称 <span class="hljs-keyword">as</span> <span class="hljs-keyword">select</span> 语句:<br></code></pre></td></tr></table></div></figure><ol><li>删除视图</li></ol><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">view</span> if <span class="hljs-keyword">exists</span> 视图名;<br></code></pre></td></tr></table></div></figure><h2 id="创建视图完整语句"><a href="#创建视图完整语句" class="heading-link"><i class="fas fa-link"></i></a><a href="#创建视图完整语句" class="headerlink" title="创建视图完整语句"></a>创建视图完整语句</h2><p>1.视图完整语句</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> [algorithm<span class="hljs-operator">=</span> &#123;<span class="hljs-keyword">merge</span> <span class="hljs-operator">||</span> temptable <span class="hljs-operator">||</span> undefined&#125; ] <span class="hljs-keyword">view</span> 视图名称<br><br><span class="hljs-keyword">select</span> 语句<br><br>[<span class="hljs-keyword">with</span> <span class="hljs-keyword">check</span> option]<br></code></pre></td></tr></table></div></figure><p>2。 视图算法</p><p>merge：合并式(替代式）算法</p><p>将视图的语句和外层的语句合并之后再执行</p><p>改算法允许更新数据</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> name, city <span class="hljs-keyword">FROM</span> person;<br><span class="hljs-keyword">CREATE</span> algorithm<span class="hljs-operator">=</span><span class="hljs-keyword">merge</span> <span class="hljs-keyword">VIEW</span> person_view1 <span class="hljs-keyword">AS</span> <span class="hljs-keyword">SELECT</span> name, city <span class="hljs-keyword">FROM</span> person;<br><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> person_view1;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 等价于<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">SELECT</span> name, city <span class="hljs-keyword">FROM</span> person) <span class="hljs-keyword">as</span> t;<br><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 增删改查都可以<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> person_view <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;it&#x27;</span>,<span class="hljs-string">&#x27;武汉&#x27;</span>）;<br></code></pre></td></tr></table></div></figure><p>temptable：临时表(具代式）算法</p><p>将视图生成一个临时表，再执行外层的语句</p><p>该算法<strong>不允许</strong>更新数据</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> name, city <span class="hljs-keyword">FROM</span> person;<br><span class="hljs-keyword">CREATE</span> algorithm<span class="hljs-operator">=</span>temptable <span class="hljs-keyword">VIEW</span> person_view2 <span class="hljs-keyword">AS</span> <span class="hljs-keyword">SELECT</span> name, city <span class="hljs-keyword">FROM</span> person;<br><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 等价于<br>(<span class="hljs-keyword">SELECT</span> name, city <span class="hljs-keyword">FROM</span> person) <span class="hljs-keyword">as</span> t<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t <br><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 增删改查都不可以<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> person_view <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;it&#x27;</span>,<span class="hljs-string">&#x27;武汉&#x27;</span>）;<br></code></pre></td></tr></table></div></figure><p>undefined：未定义算法，默认</p><p>由MySQL自己决定使用如上的哪一种算法，默认就是undefined</p><p>一般情况下会自动选择merge算法</p><p>3.视图限制(with check option)</p><p>在with check option的选项下,可以总结为</p><p>1.要保证数据update之后也要符合where的条件</p><p>2.要保证insert之后的数据能被视图查询出来</p><p>3.对于delete,有无 with check option都一样</p><p>4.对于没有where字句的视图,使用with check option是多余的</p><p>默认情况下哪怕插入的数据和更新的数据不符合创建视图条件，我们也是可以通过视图来插入和更新的</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> name, city, score <span class="hljs-keyword">FROM</span> person <span class="hljs-keyword">WHERE</span> score ＞<span class="hljs-operator">=</span> <span class="hljs-number">60</span>;<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> person_view <span class="hljs-keyword">AS</span> <span class="hljs-keyword">SELECT</span> name, city, score <span class="hljs-keyword">FROM</span> person <span class="hljs-keyword">WHERE</span> Score ＞<span class="hljs-operator">=</span> <span class="hljs-number">60</span>;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 随便编辑<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> person_view <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;it666&#x27;</span>,<span class="hljs-string">&#x27;台湾&#x27;</span>,<span class="hljs-number">33</span>)<br></code></pre></td></tr></table></div></figure><p>如果想让插入和更新的数据必须符合创建视图的条件，那么就可以在创建视图的时候添加限制条件</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> name, city, score <span class="hljs-keyword">FROM</span> person <span class="hljs-keyword">WHERE</span> score ＞<span class="hljs-operator">=</span> <span class="hljs-number">60</span>;<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> person_view <span class="hljs-keyword">AS</span> <span class="hljs-keyword">SELECT</span> name, city, score <br><span class="hljs-keyword">FROM</span> person <span class="hljs-keyword">WHERE</span> Score ＞<span class="hljs-operator">=</span> <span class="hljs-number">60</span> <span class="hljs-keyword">with</span> <span class="hljs-keyword">check</span> option;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 下面的会失败，不符合条件<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> person_view <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;it666&#x27;</span>,<span class="hljs-string">&#x27;台湾&#x27;</span>,<span class="hljs-number">33</span>)<br></code></pre></td></tr></table></div></figure><h2 id="更新视图"><a href="#更新视图" class="heading-link"><i class="fas fa-link"></i></a><a href="#更新视图" class="headerlink" title="更新视图"></a>更新视图</h2><p>视图更新限制</p><p>1.1如果视图的算法是merge 算法，那么可以更新视图</p><p>1.2如果没有指vith check option，那么无论数据符不符合创建视图条件都可以更新</p><p>1.3如果指定了with check option，那么只有符合创建视图条件才可以更新</p><p>1.4除此之外由于视图是一张虚拟表，视图是基于原始表的，更新视图的本质就是更新原始表所以只有原始表中存在的原始数据才可以更新，通过其它方式生成的数据都不可以更新</p><p>2.更新限制</p><p>聚合函数</p><p>DISTINCT关键字</p><p>GROUP BY子句</p><p>HAVING子句</p><p>UNION运算符</p><p>FROM子句包含多张表</p><p>SELECT语句中应用了不可更新的形势图</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> city <span class="hljs-keyword">FROM</span> person <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> city;<br><span class="hljs-keyword">SELECT</span> city, <span class="hljs-built_in">avg</span>(score) <span class="hljs-keyword">as</span> avgScore <span class="hljs-keyword">FROM</span> person <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> city;<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> person_view <span class="hljs-keyword">As</span> <span class="hljs-keyword">SELECT</span> city, <span class="hljs-built_in">avg</span>(score) <span class="hljs-keyword">as</span> avgScore <span class="hljs-keyword">FROM</span> person <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> city;<br><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> person_view;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 更新平均分将会失败<br><span class="hljs-keyword">UPDATE</span> person_View <span class="hljs-keyword">set</span> avgScore<span class="hljs-operator">=</span><span class="hljs-number">11</span> <span class="hljs-keyword">WHERE</span> city<span class="hljs-operator">=</span><span class="hljs-string">&#x27;北京&#x27;</span>;<br></code></pre></td></tr></table></div></figure><h2 id="Mysql预处理"><a href="#Mysql预处理" class="heading-link"><i class="fas fa-link"></i></a><a href="#Mysql预处理" class="headerlink" title="Mysql预处理"></a>Mysql预处理</h2><p>1.预处理：</p><p>所谓的预处理技术，最初也是由MySQL提出的一种减轻服务器压力的一种技术！</p><h4 id="传统mysql-处理流程"><a href="#传统mysql-处理流程" class="heading-link"><i class="fas fa-link"></i></a><a href="#传统mysql-处理流程" class="headerlink" title="传统mysql 处理流程"></a>传统mysql 处理流程</h4><p>1.在客户端准备sql语句</p><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx">select * <span class="hljs-keyword">from</span> stu where id=<span class="hljs-number">1</span>；<br></code></pre></td></tr></table></div></figure><p>2.发送sql语句到MySQL服务器</p><p>3.MySQL服务器对sql语句进行解析(词法，语法)，然后编译，然后执行该sql语句</p><p>4.服务器将执行结果返回给客户端</p><p><strong>弊端：</strong></p><p>哪怕多次传递的语句大部分内容都是相同的，每次还是要重复传递</p><p>哪怕语句是相同的，每次执行之前还是要先解析、编译之后才能执行</p><h4 id="预处理的处理流程"><a href="#预处理的处理流程" class="heading-link"><i class="fas fa-link"></i></a><a href="#预处理的处理流程" class="headerlink" title="预处理的处理流程"></a>预处理的处理流程</h4><p>1.在客户端准备预处理sql语句</p><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx">prepare 预处理名称 <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;sql语句&#x27;</span><br><br>prepare test <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;select * from stu where id=?;&#x27;</span>;<br></code></pre></td></tr></table></div></figure><p>2.发送预处理sql语句到MySQL服务器</p><p>3.MySQL服务器对预处理sql语句进行解析(词法，语法)，但不会执行</p><p>4.在客户端准备相关数据</p><figure class="highlight jsx"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx">set @id=<span class="hljs-number">1</span>;<br></code></pre></td></tr></table></div></figure><p>5.MySQL服务器对数据和预处理sql编译，然后执行该sql语句</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">execute</span> test <span class="hljs-keyword">using</span> <span class="hljs-variable">@id</span>;<br></code></pre></td></tr></table></div></figure><p>6.服务器将执行结果返回给客户端</p><p>优点：</p><p>只对sql语句进行了一次解析</p><p>重复内容大大减少(网络传输更快)</p><p>如何在MySQL中定义变量</p><p>全局变量：@变量名称</p><p>给变量赋值：set @变量名称=值：</p><h2 id="Mysql-存储过程"><a href="#Mysql-存储过程" class="heading-link"><i class="fas fa-link"></i></a><a href="#Mysql-存储过程" class="headerlink" title="Mysql 存储过程"></a>Mysql 存储过程</h2><p>1。 什么是存储过程？</p><p>存储过程和其它编程语言的函数很像，可以用于封装一组特定功能的SQL语句集</p><p>用户通过<strong>’call 存储过程的名称()’</strong>来调用执行它。</p><ol start="2"><li>存储过程基本语法</li></ol><p>2.1定义</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> 存储过程名称(形参列表)<br><br><span class="hljs-keyword">begin</span><br><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-keyword">sql</span>语句<br><br><span class="hljs-keyword">end</span>；<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> <br><br></code></pre></td></tr></table></div></figure><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span> <br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> show_stu()<br><span class="hljs-keyword">BEGIN</span><br><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> stu;<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></div></figure><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> show_stu_by_id(stuId <span class="hljs-type">int</span>)<br><span class="hljs-keyword">BEGIN</span><br><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> stu <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span>stuId;<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></div></figure><p>2.2调用</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">call</span> 存储过程名称(参数);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> <br><span class="hljs-keyword">call</span> show_stu()<br><span class="hljs-keyword">call</span> show_stu_by_id(<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></div></figure><p>3.查看存储过程</p><p>3.1查看MySQL中所有存储过程</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">procedure</span> status;<br></code></pre></td></tr></table></div></figure><p>3.2查看指定数据库中的存储过程</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">procedure</span> status <span class="hljs-keyword">where</span> db<span class="hljs-operator">=</span><span class="hljs-string">&#x27; db name&#x27;</span><br></code></pre></td></tr></table></div></figure><p>3.3查看指定存储过程的源代码</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> show_stu;<br></code></pre></td></tr></table></div></figure><p>4.删除存储过程</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">procedure</span> show_stu;<br></code></pre></td></tr></table></div></figure><h2 id="Mysql-变量存储"><a href="#Mysql-变量存储" class="heading-link"><i class="fas fa-link"></i></a><a href="#Mysql-变量存储" class="headerlink" title="Mysql 变量存储"></a>Mysql 变量存储</h2><p>1.如何在MySQL中定义变量</p><p><strong>全局变量</strong></p><p>定义：@变量名称；</p><p>赋值：</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">set</span> @全局变量名称<span class="hljs-operator">=</span>值；<br><span class="hljs-keyword">select</span> 字段名称 <span class="hljs-keyword">into</span> @全局变量名称 <span class="hljs-keyword">from</span> 表名：<br></code></pre></td></tr></table></div></figure><p><strong>局部变量</strong></p><p>定义：declare 变量名称 数据类型：</p><p>赋值：set 局部变量名称=值；</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">set</span> 局部变量名称<span class="hljs-operator">=</span>值；<br><span class="hljs-keyword">select</span> 字段名称 <span class="hljs-keyword">into</span> 局部变量名称 <span class="hljs-keyword">from</span> 表名；<br></code></pre></td></tr></table></div></figure><p>2.全局变量</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">set</span> <span class="hljs-variable">@stuId</span><span class="hljs-operator">=</span><span class="hljs-number">2</span>;<br><span class="hljs-keyword">set</span> <span class="hljs-variable">@stuName</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> stu <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-variable">@stuId</span>;<br><span class="hljs-keyword">select</span> name <span class="hljs-keyword">into</span> <span class="hljs-variable">@stuName</span> <span class="hljs-keyword">from</span> stu <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-variable">@stuId</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-variable">@stuName</span> <span class="hljs-keyword">from</span> dual;<br></code></pre></td></tr></table></div></figure><p>3.局部变量</p><p>局部变量只能在存储过程和函数中定义，所以也称之为存储过程变量</p><p>default 可以设置默认值</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> show_stu()<br><span class="hljs-keyword">BEGIN</span><br>	<span class="hljs-keyword">declare</span> stuId2 <span class="hljs-type">int</span>;<br>	<span class="hljs-keyword">declare</span> stuName <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>);<br>	<span class="hljs-keyword">set</span> stuId2 <span class="hljs-operator">=</span><span class="hljs-number">2</span>;<br>	<span class="hljs-keyword">select</span> name <span class="hljs-keyword">into</span> stuName <span class="hljs-keyword">from</span> stu <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-variable">@stuId</span>;<br>	<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> stu <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span>stuId;<br>	<span class="hljs-keyword">select</span> stuName <span class="hljs-keyword">from</span> dual;<br><span class="hljs-keyword">END</span><br><span class="hljs-keyword">call</span> show_stu();<br></code></pre></td></tr></table></div></figure><h2 id="Mysql-储存过程深入"><a href="#Mysql-储存过程深入" class="heading-link"><i class="fas fa-link"></i></a><a href="#Mysql-储存过程深入" class="headerlink" title="Mysql 储存过程深入"></a>Mysql 储存过程深入</h2><p>1.存储过程参数：</p><p>MySQL存储过程中的参数分为：</p><p>in 输入参数[默认]</p><p>out 输出参数</p><p>inout 输入输出参数</p><p>示例一：输入参数</p><p>外界传递给我们的参数</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> show_stu_by_id(<span class="hljs-keyword">in</span> stuId <span class="hljs-type">int</span>)<br><span class="hljs-keyword">BEGIN</span><br><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> stu <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span>stuId;<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></div></figure><p>示例二：输出参数</p><p>存储过程中返回给外界的参数</p><p>MySQL存储过程中不能使用return返回值，需要通过参数来向外返回值</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> show_stu_by_id(<span class="hljs-keyword">in</span> stuId <span class="hljs-type">int</span>,<span class="hljs-keyword">out</span> stuName <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>))<br><span class="hljs-keyword">BEGIN</span><br>	<span class="hljs-keyword">SELECT</span> name <span class="hljs-keyword">into</span> stuName <span class="hljs-keyword">FROM</span> stu <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span>stuId;<br><span class="hljs-keyword">END</span><br><br><span class="hljs-keyword">set</span> <span class="hljs-variable">@stuName</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-keyword">call</span> show_stu_by_id(<span class="hljs-number">1</span>,<span class="hljs-variable">@stuName</span>);<br><span class="hljs-keyword">select</span> <span class="hljs-variable">@stuName</span> <span class="hljs-keyword">from</span> dual;<br></code></pre></td></tr></table></div></figure><p>示例三：输入输出参数</p><p>同时具备了输入参数和输出参数所有功能</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> show_stu_by_id(<span class="hljs-keyword">inout</span> data <span class="hljs-type">int</span>)<br><span class="hljs-keyword">BEGIN</span><br>	<span class="hljs-keyword">SELECT</span> age <span class="hljs-keyword">into</span> data <span class="hljs-keyword">FROM</span> stu <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span>data;<br><span class="hljs-keyword">END</span><br><br><span class="hljs-keyword">set</span> <span class="hljs-variable">@data</span><span class="hljs-operator">=</span><span class="hljs-number">1</span>;<br><span class="hljs-keyword">call</span> show_stu_by_id(<span class="hljs-variable">@data</span>);<br><span class="hljs-keyword">select</span> <span class="hljs-variable">@data</span> <span class="hljs-keyword">from</span> dual;<br></code></pre></td></tr></table></div></figure><h2 id="自定义函数"><a href="#自定义函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#自定义函数" class="headerlink" title="自定义函数"></a>自定义函数</h2><p>1.什么是自定义函数</p><p>自定义函数和存储过程很像，只不过自定义函数不需要手动通过call调用</p><p>而是和其它的聚合函数一样会在SQL语句中自动被调用</p><p>例如：select avg (score) from stu</p><p>例如：select count (*) from stu where age &gt;=18；</p><p>2.创建自定义函数</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">function</span> 函数名（形参列表） <span class="hljs-keyword">returns</span> 数据类型 函数特征 <br><span class="hljs-keyword">begin</span><br><br><span class="hljs-keyword">sql</span>语句：<br>... ...<br><span class="hljs-keyword">return</span> 值；<br><br><span class="hljs-keyword">end</span>：<br></code></pre></td></tr></table></div></figure><p>函数特征</p><p>1.DETERMINISTIC 不确定的</p><p>2.NO SQL 没有SQl语句，当然也不会修改数据</p><p>3.READS SQL DATA 只是读取数据，不会修改数据</p><p>4.MODIFIES SQL DATA 要修改数据 5 CONTAINS SOL 包含了SQL语句</p><p>3.调用函数</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> 函数名称(参数) <span class="hljs-keyword">from</span> dual;<br></code></pre></td></tr></table></div></figure><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">function</span> fun_add(a <span class="hljs-type">int</span>,b <span class="hljs-type">int</span>) <span class="hljs-keyword">returns</span> <span class="hljs-type">int</span> <span class="hljs-keyword">DETERMINISTIC</span><br><span class="hljs-keyword">begin</span><br><br><span class="hljs-keyword">declare</span> sum <span class="hljs-type">int</span> <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>;<br><span class="hljs-keyword">set</span> sum <span class="hljs-operator">=</span>a<span class="hljs-operator">+</span>b;<br><span class="hljs-keyword">return</span> sum;<br><br><span class="hljs-keyword">end</span>;<br></code></pre></td></tr></table></div></figure><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">function</span> check_stu(stuId <span class="hljs-type">int</span>) <span class="hljs-keyword">returns</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DETERMINISTIC</span><br><span class="hljs-keyword">begin</span><br><span class="hljs-keyword">declare</span> stuName <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-keyword">select</span> name <span class="hljs-keyword">into</span> stuName <span class="hljs-keyword">from</span> stu <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span> stuId;<br><span class="hljs-keyword">return</span> stuName;<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></div></figure><h2 id="条件语句"><a href="#条件语句" class="heading-link"><i class="fas fa-link"></i></a><a href="#条件语句" class="headerlink" title="条件语句"></a>条件语句</h2><p>1.IF语</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">if 条件表达式 <span class="hljs-keyword">then</span><br>...<br>elseif 条件表达式 <span class="hljs-keyword">then</span><br>...<br><span class="hljs-keyword">else</span><br>...<br><span class="hljs-keyword">end</span> if;<br></code></pre></td></tr></table></div></figure><p>示例一:</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">function</span> fun_test(age <span class="hljs-type">int</span>) <span class="hljs-keyword">returns</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DETERMINISTIC</span><br><span class="hljs-keyword">begin</span><br><br><span class="hljs-keyword">declare</span> <span class="hljs-keyword">result</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;&#x27;</span>;<br>if age<span class="hljs-operator">&gt;=</span><span class="hljs-number">18</span> <span class="hljs-keyword">then</span><br><span class="hljs-keyword">set</span> <span class="hljs-keyword">result</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;成年人&#x27;</span>;<br><br><span class="hljs-keyword">else</span><br><span class="hljs-keyword">set</span> <span class="hljs-keyword">result</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;未成年人&#x27;</span>;<br><span class="hljs-keyword">end</span> if;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">result</span>;<br><br><span class="hljs-keyword">end</span>;<br><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 使用<br><span class="hljs-keyword">SELECT</span> fun_test(<span class="hljs-number">2</span>) <span class="hljs-keyword">from</span> DUAL;<br></code></pre></td></tr></table></div></figure><p>示例二:</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">function</span> fn_test2(score <span class="hljs-type">int</span>) <span class="hljs-keyword">returns</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DETERMINISTIC</span> <br><br><span class="hljs-keyword">begin</span><br><span class="hljs-keyword">declare</span> <span class="hljs-keyword">result</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;&#x27;</span>;<br>if score<span class="hljs-operator">&lt;</span><span class="hljs-number">0</span><span class="hljs-operator">||</span> score <span class="hljs-operator">&gt;</span> <span class="hljs-number">100</span> <span class="hljs-keyword">then</span><br><span class="hljs-keyword">set</span> <span class="hljs-keyword">result</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;没有这个分数&#x27;</span>;<br>elseif score <span class="hljs-operator">&lt;</span> <span class="hljs-number">60</span> <span class="hljs-keyword">then</span><br><span class="hljs-keyword">set</span> <span class="hljs-keyword">result</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;不及格&#x27;</span>;<br>elseif score <span class="hljs-operator">&lt;</span><span class="hljs-number">80</span> <span class="hljs-keyword">then</span><br><span class="hljs-keyword">set</span> <span class="hljs-keyword">result</span><span class="hljs-operator">=</span> <span class="hljs-string">&#x27;良好&#x27;</span>;<br><span class="hljs-keyword">else</span> <br><span class="hljs-keyword">set</span> <span class="hljs-keyword">result</span> <span class="hljs-operator">=</span><span class="hljs-string">&#x27;优秀&#x27;</span>;<br><span class="hljs-keyword">end</span> if;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">result</span>;<br><span class="hljs-keyword">end</span>;<br><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 使用<br><span class="hljs-keyword">SELECT</span> fun_test2(<span class="hljs-number">2</span>) <span class="hljs-keyword">from</span> DUAL;<br></code></pre></td></tr></table></div></figure><p>2.CASE语句</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">case</span><br><br><span class="hljs-keyword">when</span> 条件表达式 <span class="hljs-keyword">then</span><br>...<br><span class="hljs-keyword">when</span> 条件表达式 <span class="hljs-keyword">then</span><br>...<br><span class="hljs-keyword">end</span> <span class="hljs-keyword">case</span>:<br></code></pre></td></tr></table></div></figure><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">function</span> check_stu(score <span class="hljs-type">int</span>) <span class="hljs-keyword">returns</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DETERMINISTIC</span><br><span class="hljs-keyword">begin</span><br><span class="hljs-keyword">declare</span> <span class="hljs-keyword">result</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-keyword">case</span><br><br><span class="hljs-keyword">when</span> score<span class="hljs-operator">=</span><span class="hljs-number">100</span> <span class="hljs-keyword">then</span><br><span class="hljs-keyword">result</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;keeping&#x27;</span>;<br><span class="hljs-keyword">when</span>  score<span class="hljs-operator">=</span><span class="hljs-number">0</span> <span class="hljs-keyword">then</span><br><span class="hljs-keyword">result</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;not keeping&#x27;</span>;<br><span class="hljs-keyword">end</span> <span class="hljs-keyword">case</span>:<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">result</span>;<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></div></figure><p>3.循环语句</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">while 条件表达式 do<br>...<br><span class="hljs-keyword">end</span> while;<br></code></pre></td></tr></table></div></figure><p>示例:1+ n的和/ 1+ 2+3+4+5</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">function</span> fun_test6(num <span class="hljs-type">int</span>) <span class="hljs-keyword">returns</span> <span class="hljs-type">int</span> <span class="hljs-keyword">DETERMINISTIC</span> <br><span class="hljs-keyword">begin</span><br><span class="hljs-keyword">declare</span> sum <span class="hljs-type">int</span> <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>;<br><span class="hljs-keyword">declare</span> currentIndex <span class="hljs-type">int</span> <span class="hljs-keyword">default</span> <span class="hljs-number">1</span>;<br>while currentIndex <span class="hljs-operator">&lt;=</span> num do<br><span class="hljs-keyword">set</span> sum<span class="hljs-operator">=</span>sum<span class="hljs-operator">+</span>currentIndex;<br><span class="hljs-keyword">set</span> currentIndex<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">+</span>currentIndex;<br><br><span class="hljs-keyword">end</span> while;<br><br><span class="hljs-keyword">return</span> sum;<br> <span class="hljs-keyword">end</span>;<br><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 使用<br><span class="hljs-keyword">select</span> fun_test6(<span class="hljs-number">4</span>) <span class="hljs-keyword">from</span> DUAL;<br></code></pre></td></tr></table></div></figure><p>repeat 循环</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">repeat<br>...<br>until 条件表达式 <span class="hljs-keyword">end</span> repeat;<br></code></pre></td></tr></table></div></figure><p>示例:</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">function</span> fun_test6(num <span class="hljs-type">int</span>) <span class="hljs-keyword">returns</span> <span class="hljs-type">int</span> <span class="hljs-keyword">DETERMINISTIC</span> <br><span class="hljs-keyword">begin</span><br><span class="hljs-keyword">declare</span> sum <span class="hljs-type">int</span> <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>;<br><span class="hljs-keyword">declare</span> currentIndex <span class="hljs-type">int</span> <span class="hljs-keyword">default</span> <span class="hljs-number">1</span>;<br>repeat<br>	<span class="hljs-keyword">set</span> sum<span class="hljs-operator">=</span>sum<span class="hljs-operator">+</span>currentIndex;<br><span class="hljs-keyword">set</span> currentIndex<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">+</span>currentIndex;<br>until currentIndex <span class="hljs-operator">&gt;</span> num <span class="hljs-keyword">end</span> repeat;<br><br><span class="hljs-keyword">return</span> sum;<br> <span class="hljs-keyword">end</span>;<br><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 使用<br><span class="hljs-keyword">select</span> fun_test6(<span class="hljs-number">4</span>) <span class="hljs-keyword">from</span> DUAL;<br></code></pre></td></tr></table></div></figure><h2 id="批量数据处理"><a href="#批量数据处理" class="heading-link"><i class="fas fa-link"></i></a><a href="#批量数据处理" class="headerlink" title="批量数据处理"></a>批量数据处理</h2><p>需求：往数据库里存储一万条数据实现方案：</p><p>1.写一万条insert into语句</p><p>2.将insert into语句封装到存储过程或者函数中</p><p>将来怎么使用？</p><p>是配合其它SQL语句使用，还是单独使用</p><p>单独使用–存储过程</p><p>配合其它SQL语句使用一-自定义函数</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> add_status(num <span class="hljs-type">int</span>)<br><span class="hljs-keyword">begin</span><br>  <span class="hljs-keyword">DECLARE</span> currentId <span class="hljs-type">int</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">DECLARE</span> currentAge <span class="hljs-type">int</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">DECLARE</span> currentName <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;&#x27;</span>;<br>while currentId<span class="hljs-operator">&lt;</span>num do<br>	<span class="hljs-keyword">set</span> currentId<span class="hljs-operator">=</span>currentId<span class="hljs-operator">+</span><span class="hljs-number">1</span>; <br>	<span class="hljs-keyword">set</span> currentAge<span class="hljs-operator">=</span> <span class="hljs-built_in">FLOOR</span>(RAND()<span class="hljs-operator">*</span><span class="hljs-number">30</span>);<br>	<span class="hljs-keyword">set</span> currentName<span class="hljs-operator">=</span> concat(<span class="hljs-string">&#x27;it&#x27;</span>,currentAge);<br>	<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> stu <span class="hljs-keyword">VALUES</span>(currentId,currentName,currentAge);<br><span class="hljs-keyword">end</span> WHILE;<br><span class="hljs-keyword">end</span>;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 调用 <span class="hljs-keyword">call</span><br><span class="hljs-keyword">CALL</span> add_status(<span class="hljs-number">10000</span>);<br></code></pre></td></tr></table></div></figure><p>注意点：</p><p>以上封装存在的问题，默认情况下每生成一条插入语句，就会立即执行这条插入的语句</p><p>所以整个过程我们生成了一万条插入语句，我们解析了一万条插入的语句，编译了一万条语句，执行了一万条语句，所以比较耗时</p><p><strong>优化方式1</strong></p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> add_status3(num <span class="hljs-type">int</span>)<br><span class="hljs-keyword">begin</span><br>  <span class="hljs-keyword">DECLARE</span> currentId <span class="hljs-type">int</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">DECLARE</span> currentAge <span class="hljs-type">int</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">DECLARE</span> currentName <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-keyword">set</span> autocommit<span class="hljs-operator">=</span><span class="hljs-number">0</span>;<br>while currentId<span class="hljs-operator">&lt;</span>num do<br>	<span class="hljs-keyword">set</span> currentId<span class="hljs-operator">=</span>currentId<span class="hljs-operator">+</span><span class="hljs-number">1</span>; <br>	<span class="hljs-keyword">set</span> currentAge<span class="hljs-operator">=</span> <span class="hljs-built_in">FLOOR</span>(RAND()<span class="hljs-operator">*</span><span class="hljs-number">30</span>);<br>	<span class="hljs-keyword">set</span> currentName<span class="hljs-operator">=</span> concat(<span class="hljs-string">&#x27;it&#x27;</span>,currentAge);<br>	<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> stu <span class="hljs-keyword">VALUES</span>(currentId,currentName,currentAge);<br><span class="hljs-keyword">end</span> WHILE;<br><span class="hljs-keyword">commit</span>;<br><span class="hljs-keyword">end</span>;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 调用 <span class="hljs-keyword">call</span><br><span class="hljs-keyword">CALL</span> add_status3(<span class="hljs-number">10000</span>);<br></code></pre></td></tr></table></div></figure><p>set autocommit=0; commit;</p><p>等到循环结束以后再去执行sql语句</p><p>注意点：</p><p>只要在循环前面加上set autocommit = 0；，在循环后面加上commit；</p><p>那么就不会生成一条插入语句就执行一条插入语句了</p><p>会等到所有的插入语句都生成之后，再统一的解析，统一的编译，统一的执行</p><p>优化方式2</p><p><strong>预处理不能使用局部变量</strong></p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> add_status4(num <span class="hljs-type">int</span>)<br><span class="hljs-keyword">begin</span><br>  <span class="hljs-keyword">set</span> <span class="hljs-variable">@currentId</span> <span class="hljs-operator">=</span><span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">set</span> <span class="hljs-variable">@currentAge</span><span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">set</span> <span class="hljs-variable">@currentName</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;&#x27;</span>;<br>	<span class="hljs-keyword">prepare</span> test <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;INSERT INTO stu VALUES(?,?,?);&#x27;</span>;<br>while <span class="hljs-variable">@currentId</span><span class="hljs-operator">&lt;</span>num do<br>	<span class="hljs-keyword">set</span> <span class="hljs-variable">@currentId</span><span class="hljs-operator">=</span><span class="hljs-variable">@currentId</span><span class="hljs-operator">+</span><span class="hljs-number">1</span>; <br>	<span class="hljs-keyword">set</span> <span class="hljs-variable">@currentAge</span><span class="hljs-operator">=</span> <span class="hljs-built_in">FLOOR</span>(RAND()<span class="hljs-operator">*</span><span class="hljs-number">30</span>);<br>	<span class="hljs-keyword">set</span> <span class="hljs-variable">@currentName</span><span class="hljs-operator">=</span> concat(<span class="hljs-string">&#x27;it&#x27;</span>,<span class="hljs-variable">@currentAge</span>);<br>	<span class="hljs-keyword">execute</span> test <span class="hljs-keyword">using</span> <span class="hljs-variable">@currentId</span>,<span class="hljs-variable">@currentName</span>,<span class="hljs-variable">@currentAge</span>;<br><span class="hljs-keyword">end</span> WHILE;<br><span class="hljs-keyword">end</span>;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 调用 <span class="hljs-keyword">call</span><br><span class="hljs-keyword">CALL</span> add_status4(<span class="hljs-number">10000</span>);<br></code></pre></td></tr></table></div></figure><p><strong>两者结合</strong></p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> add_status4(num <span class="hljs-type">int</span>)<br><span class="hljs-keyword">begin</span><br>  <span class="hljs-keyword">set</span> <span class="hljs-variable">@currentId</span> <span class="hljs-operator">=</span><span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">set</span> <span class="hljs-variable">@currentAge</span><span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">set</span> <span class="hljs-variable">@currentName</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;&#x27;</span>;<br>	<span class="hljs-keyword">prepare</span> test <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;INSERT INTO stu VALUES(?,?,?);&#x27;</span>;<br>	<span class="hljs-keyword">set</span> autocommit<span class="hljs-operator">=</span><span class="hljs-number">0</span>;<br>while <span class="hljs-variable">@currentId</span><span class="hljs-operator">&lt;</span>num do<br>	<span class="hljs-keyword">set</span> <span class="hljs-variable">@currentId</span><span class="hljs-operator">=</span><span class="hljs-variable">@currentId</span><span class="hljs-operator">+</span><span class="hljs-number">1</span>; <br>	<span class="hljs-keyword">set</span> <span class="hljs-variable">@currentAge</span><span class="hljs-operator">=</span> <span class="hljs-built_in">FLOOR</span>(RAND()<span class="hljs-operator">*</span><span class="hljs-number">30</span>);<br>	<span class="hljs-keyword">set</span> <span class="hljs-variable">@currentName</span><span class="hljs-operator">=</span> concat(<span class="hljs-string">&#x27;it&#x27;</span>,<span class="hljs-variable">@currentAge</span>);<br>	<span class="hljs-keyword">execute</span> test <span class="hljs-keyword">using</span> <span class="hljs-variable">@currentId</span>,<span class="hljs-variable">@currentName</span>,<span class="hljs-variable">@currentAge</span>;<br><span class="hljs-keyword">end</span> WHILE;<br><span class="hljs-keyword">commit</span>;<br><span class="hljs-keyword">end</span>;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 调用 <span class="hljs-keyword">call</span><br><span class="hljs-keyword">CALL</span> add_status4(<span class="hljs-number">10000</span>);<br></code></pre></td></tr></table></div></figure><h2 id="Mysql-索引介绍"><a href="#Mysql-索引介绍" class="heading-link"><i class="fas fa-link"></i></a><a href="#Mysql-索引介绍" class="headerlink" title="Mysql 索引介绍"></a>Mysql 索引介绍</h2><p>1.什么是索引</p><p>索引就相当于字典中的目录（拼音/偏旁部首手）</p><p>有了目录我们就能通过目录快速的找到想要的结果，</p><p>但是如果没有目录（拼音/偏旁部首手），没有索引</p><p>那么如果想要查找某条数据就必须从前往后一条一条的查找</p><p>所以索引就是用于帮助我们提升数据的查询速度的</p><p>2.索引的优缺点和使用原则</p><p>2.1优点</p><ul><li>大大加快数据的查询速度</li><li>没有任何限制，所有Mysql字段都可以用作索引</li></ul><p>2.2缺点</p><ul><li>索引是真实存在的会占空间，会增加数据库体积</li><li>如果对作为索引的字段进行增删修操作，系统需要花费时间去更新维护索引</li></ul><p>2.3原则</p><ul><li>对经常用于查询的字段应该创建索引(作为where条件字段、作为group by分组的字段，作为order by排序的字段)</li><li>对于<strong>主键和外键</strong>系统会自动创建索引，无序我们手动创建</li><li>对于数据量小的表不需要刻意使用索引</li></ul><p>3.索引分类</p><ul><li>单值索引：将某个字段的值作为索引</li><li>复合索引：将多个字段的值作为索引</li><li>唯一索引（唯一键）：索引列中的值必须是唯一的，但是允许为空值</li><li>主键索引：是一种特殊的唯一索引，不允许有空值</li></ul><h2 id="索引的创建和修改"><a href="#索引的创建和修改" class="heading-link"><i class="fas fa-link"></i></a><a href="#索引的创建和修改" class="headerlink" title="索引的创建和修改"></a>索引的创建和修改</h2><p>1.查看当前查询是否使用索引</p><p>1.1查询没有索引的表</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> stu <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">999999</span>;## <span class="hljs-number">0.695</span><br></code></pre></td></tr></table></div></figure><p>1.2查询有索引的表</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> stu2 <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">999999</span>;## <span class="hljs-number">0.008</span><br></code></pre></td></tr></table></div></figure><p>1.3如何查看当前的查询语句有没有用到素引</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> stu2 <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">999999</span>;## 查看key字段<br></code></pre></td></tr></table></div></figure><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql26.png" alt="Untitled"></p><p>如果返回的结果集中的key有值，那么就表示当前的查询语句中用到了索引</p><p>如果返回的结果集中的key没有值，那么就表示当前的查询语句中没有用到索引</p><p>2.如何添加索引</p><p>2.1给表设置主键，只要设置了主键，那么系统就会自动创建对应的索引</p><p>2.2给表设置外键，只要设置了外键，那么系统就会自动创建对应的索引</p><p>2.3给表设置唯一键，只要设置了某一个字段的取值是唯一的，也会自动创建对应的索引</p><p>2.4创建表的时候指定给哪个字段添加索引</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> test1(<br>	id <span class="hljs-type">int</span>,<br>	name <span class="hljs-type">varchar</span> (<span class="hljs-number">20</span>),<br>	index idx_name (id) #创建索引<br>)<br></code></pre></td></tr></table></div></figure><p>2.5创建好表之后再给指定字段添加索引</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> test2(<br>	id <span class="hljs-type">int</span>，<br>	name <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>)，<br>)<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 下面的方式任选一种<br><span class="hljs-keyword">create</span> index idx_name <span class="hljs-keyword">on</span> test2(id)；#创建索引<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> test3 <span class="hljs-keyword">add</span> index idx_name(id) ## 创建索引<br></code></pre></td></tr></table></div></figure><p>3.删除索引</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">drop</span> index 索引名称 <span class="hljs-keyword">on</span> 表名<br></code></pre></td></tr></table></div></figure><h2 id="索引算法"><a href="#索引算法" class="heading-link"><i class="fas fa-link"></i></a><a href="#索引算法" class="headerlink" title="索引算法"></a>索引算法</h2><p>1.什么是索引算法？</p><p>索引算法决定了如何创建索引</p><p>索引算法决定了如何查找索引对应的数据</p><p><strong>传统查找</strong></p><p>1， 2， 3， 4， 5</p><p><strong>btree查找</strong></p><p>平衡的多叉树</p><p>BTree索引是基于平衡多叉排序树实现的,能够缩短查找的次数</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/mysql27.png" alt="Untitled"></p><p><strong>Hahs索引</strong></p><p>哈希索引是基于哈希表实现的,只能用于memory存储引擎,可以一次性定位到指定数据</p><h2 id="Node与Mysql"><a href="#Node与Mysql" class="heading-link"><i class="fas fa-link"></i></a><a href="#Node与Mysql" class="headerlink" title="Node与Mysql"></a>Node与Mysql</h2><p>1.如何在Node程序中操作MySOL数据库？</p><p>我们都知道操作MySQL数据库就是连接MySQL服务器，给MySQL服务器发送指令在NodeJS中我们可以借助第三方库来连接MySQL服务器，给MySQL服务器发送指令</p><p>1.1 mysql驱动库</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">npm install mysql<br></code></pre></td></tr></table></div></figure><p>1.2 mysal2驱动库</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">npm install mysql2<br></code></pre></td></tr></table></div></figure><p>2。由于node第三方库还不支持最新的mysql加密，所以我们需要修改为旧版本加密方式</p><p>2.1、更改加密方式：</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> ‘ root‘ @‘ localhost‘ IDENTIFIED <span class="hljs-keyword">BY</span> ‘ password‘ PASSWORD EXPIRE NEVER;<br></code></pre></td></tr></table></div></figure><p>2.2、更改密码：该例子中123为新密码</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> ‘ root‘ @‘ localhost‘ IDENT IFIED <span class="hljs-keyword">WITH</span> mysgl native password <span class="hljs-keyword">BY</span> root<br></code></pre></td></tr></table></div></figure><h2 id="Sequelize"><a href="#Sequelize" class="heading-link"><i class="fas fa-link"></i></a><a href="#Sequelize" class="headerlink" title="Sequelize"></a>Sequelize</h2><p>1.什么是Sequelize？</p><p>Sequelize是一个基于Promise的NodeJS ORM模块</p><p>2.什么是ORM？</p><p>ORM (Object-Relational-Mapping) 是对象关系映射</p><p>对象关系映射可以把JS中的类和对象，和数据库中的表和数据进行关系映射映射</p><p>之后我们就可以直接通过类和对象来操作数据表和数据了，就不用编写SQL</p><p>ORM有效的解决了直接在NodeJS中编写SQL不够直观，不够高效，容易出错等问题</p><p>3.如何映射？</p><p>在Sequelize中Js中的一个类(一个模型） 就对应数据库中的一张表</p><p>在Sequelize中JS中的一个对象就对应表中的一条数据（一条记录）</p><p>在Sequelize中Js中的一个对象的属性就对应一条数据的一个字段</p><h2 id="Sequelize基本使用"><a href="#Sequelize基本使用" class="heading-link"><i class="fas fa-link"></i></a><a href="#Sequelize基本使用" class="headerlink" title="Sequelize基本使用"></a>Sequelize基本使用</h2><p>1.Sequelize基本使用</p><p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://sequelize.org/">https://sequelize.org/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>2.什么是数据库连接池？</p><p>默认情况下有一个人要使用数据库，那么就必须创建一个连接</p><p>默认情况下有一个人不用数据库了，为了不占用资源，那么就必须销毁一个连接</p><p>但是频繁的创建和销毁连接是非常消耗服务器性能的，所以为了提升服务器性能就有了连接池</p><p>数据库连接池是负责分配、管理和释放数据库连接</p><p>它允许应用程序重复使用一个现有的数据库连接，而不是再重新建立一个<br><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/image/20220905163945.png"></p><h2 id="Sequelize创建表"><a href="#Sequelize创建表" class="heading-link"><i class="fas fa-link"></i></a><a href="#Sequelize创建表" class="headerlink" title="Sequelize创建表"></a>Sequelize创建表</h2><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">const <span class="hljs-keyword">User</span> <span class="hljs-operator">=</span> sequelize.define(<span class="hljs-string">&#x27;User&#x27;</span>, &#123;<br>  username: DataTypes.STRING,<br>  birthday: DataTypes.DATE,<br>&#125;);<br></code></pre></td></tr></table></div></figure><p>1.sequelize在根据模型创建表的时候，会自动将我们指定的表的名称变成复数</p><p>2.sequelize在根据模型创建表的时候，会自动增加两个字段 createAt/updateAt</p><h2 id="Sequelize-CLI创建数据库"><a href="#Sequelize-CLI创建数据库" class="heading-link"><i class="fas fa-link"></i></a><a href="#Sequelize-CLI创建数据库" class="headerlink" title="Sequelize-CLI创建数据库"></a>Sequelize-CLI创建数据库</h2><p>1.什么是Sequelize-CLI？</p><p>在编程开发中为了能够更好的管理代码，我们可以使用Git来管理我们的代码，</p><p>实现对代码变更的追踪，实现在各个不同版本之间切换</p><p>在数据库开发中为了能够更好的管理数据库，我们也可以使用数据库迁移工具来管理我们的数据库， 实现对数据库变更的追踪，实现在各个不同版本之间切换</p><p>Sequelize-CLI就是一款数据库迁移工具，能够让我们追踪数据库的变更，在各个不同版本之间随意切换</p><p>2.如何使用Sequelize-CLI？</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">npm i sequelize sequelize<span class="hljs-operator">-</span>cli mysgl2 <span class="hljs-operator">-</span>s<br><br>npx sequelize <span class="hljs-comment">--help</span><br></code></pre></td></tr></table></div></figure><p>3.初始化Sequelize-CLI</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">npx sequelize<span class="hljs-operator">-</span>cli init<br></code></pre></td></tr></table></div></figure><p>config：数据库配置文件，用于告诉CLI如何连接数据库</p><p>models：数据库模型文件，用于告诉CLI如何创建表</p><p>migrations：数据库迁移文件，用于记录用户不同版本操作</p><p>seeders：数据库种子文件，用于编写测试数据</p><p>修改环境变量</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">set</span> NODE_ENV<span class="hljs-operator">=</span>test<br></code></pre></td></tr></table></div></figure><p>4.创建</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">npx sequelize db:<span class="hljs-keyword">create</span><br></code></pre></td></tr></table></div></figure><h2 id="Sequelize-CLI创建表"><a href="#Sequelize-CLI创建表" class="heading-link"><i class="fas fa-link"></i></a><a href="#Sequelize-CLI创建表" class="headerlink" title="Sequelize-CLI创建表"></a>Sequelize-CLI创建表</h2><p>1.创建模型</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">npx sequelize model: generate <span class="hljs-operator">-</span>name XXX <span class="hljs-comment">--attributes key: type</span><br></code></pre></td></tr></table></div></figure><p>2.根据模型创建表</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">npx sequelize db:migrate<br></code></pre></td></tr></table></div></figure><p>3.回退到某个时刻</p><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">npx sequelize db:migrate:undo <span class="hljs-operator">/</span><span class="hljs-operator">/</span> 回退到上一个版本<br><br>npx sequelize db:migrate:undo:a11<span class="hljs-operator">/</span><span class="hljs-operator">/</span> 回退所有<br><br>npx sequelize db:migrate:undo <span class="hljs-operator">-</span>name<span class="hljs-number">-20200329045955</span><span class="hljs-operator">-</span><span class="hljs-keyword">create</span><span class="hljs-operator">-</span>book. js <span class="hljs-operator">/</span><span class="hljs-operator">/</span> 回退指定操作<br></code></pre></td></tr></table></div></figure><h2 id="Sequelize-CLI修改表"><a href="#Sequelize-CLI修改表" class="heading-link"><i class="fas fa-link"></i></a><a href="#Sequelize-CLI修改表" class="headerlink" title="Sequelize-CLI修改表"></a>Sequelize-CLI修改表</h2><p>1.如何修改表？</p><p>使用Sequelize-CL1管理数据库的目的就是为了监控数据库的变化所以我们不能直接修改表的结构，如果要修改，必须通过migration文件修改这样我们就能记录修改操作，就能追踪修改过程，就能回退到指定版本</p><p>2.修改表步骤</p><p>2.1 通过 migration：generate 创建迁移文件</p><p>2.2 在迁移文件中编写修改的内容</p><p>2.3 通过 db：migrate 执行编写好的迁移文件</p></div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ 本文结束，感谢您的阅读 ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">本文作者: </span><span class="copyright-author__value"><a href="https://kitety.github.io">kitety</a></span></div><div class="copyright-link"><span class="copyright-link__name">本文链接: </span><span class="copyright-link__value"><a href="https://kitety.github.io/posts/mysql-study-note.html">https://kitety.github.io/posts/mysql-study-note.html</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">版权声明: </span><span class="copyright-notice__value">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> 许可协议。转载请注明出处！</span></div></div><div class="post-tags"><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="https://kitety.github.io/tags/mysql/">mysql</a></span></div><div class="post-share"><div class="social-share" data-sites="qzone, qq, weibo, wechat, douban, linkedin, facebook, twitter, google">Share to:</div></div><div class="post-reward reward"><div class="reward-button">请我喝杯咖啡~</div><div class="reward-qrcode"><span class="reward-qrcode-alipay"><img class="reward-qrcode-alipay__img" src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/2020-9-23/1600862258262-image.png"><div class="reward-qrcode-alipay__text">支付宝打赏</div></span><span class="reward-qrcode-wechat"><img class="reward-qrcode-wechat__img" src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/2020-9-23/1600862240495-image.png"><div class="reward-qrcode-wechat__text">微信打赏</div></span></div></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/posts/cs-61a-1.html"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">CS 61 A (Part 1)</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/posts/nestjs-study-notes.html"><span class="paginator-prev__text">Nestjs学习笔记</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div><div class="comments" id="comments"><div id="disqus_thread"></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">文章目录</span><span class="sidebar-nav-ov">站点概览</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC"><span class="toc-number">2.</span> <span class="toc-text">基本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85mysql"><span class="toc-number">3.</span> <span class="toc-text">安装mysql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%93%BE%E6%8E%A5%E5%92%8C%E6%96%AD%E5%BC%80"><span class="toc-number">4.</span> <span class="toc-text">链接和断开</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%A6%82%E5%BF%B5"><span class="toc-number">5.</span> <span class="toc-text">其他概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="toc-number">6.</span> <span class="toc-text">数据库的创建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%88%A0%E9%99%A4"><span class="toc-number">7.</span> <span class="toc-text">数据库的删除</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E4%BF%AE%E6%94%B9%E5%92%8C%E6%9F%A5%E7%9C%8B"><span class="toc-number">8.</span> <span class="toc-text">数据库的修改和查看</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5"><span class="toc-number">9.</span> <span class="toc-text">表的增删改查</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A1%A8"><span class="toc-number">10.</span> <span class="toc-text">删除表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%A8"><span class="toc-number">11.</span> <span class="toc-text">修改表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">12.</span> <span class="toc-text">存储引擎</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E5%92%8C%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE"><span class="toc-number">13.</span> <span class="toc-text">插入和更新数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%A1%A8%E6%95%B0%E6%8D%AE"><span class="toc-number">14.</span> <span class="toc-text">查询表数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A1%A8%E6%95%B0%E6%8D%AE"><span class="toc-number">15.</span> <span class="toc-text">删除表数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Navicat"><span class="toc-number">16.</span> <span class="toc-text">Navicat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">17.</span> <span class="toc-text">数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B4%E5%9E%8B%E7%B1%BB%E5%9E%8B"><span class="toc-number">17.0.1.</span> <span class="toc-text">整型类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%AE%E7%82%B9%E7%B1%BB%E5%9E%8B"><span class="toc-number">17.0.2.</span> <span class="toc-text">浮点类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E7%82%B9%E7%B1%BB%E5%9E%8B"><span class="toc-number">17.0.3.</span> <span class="toc-text">定点类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E7%B1%BB%E5%9E%8B"><span class="toc-number">17.0.4.</span> <span class="toc-text">字符类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E7%B1%BB%E5%9E%8B"><span class="toc-number">17.0.5.</span> <span class="toc-text">文本类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B"><span class="toc-number">17.0.6.</span> <span class="toc-text">枚举类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B"><span class="toc-number">17.0.7.</span> <span class="toc-text">集合类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E7%B1%BB%E5%9E%8B"><span class="toc-number">17.0.8.</span> <span class="toc-text">日期类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E7%B1%BB%E5%9E%8B"><span class="toc-number">17.0.9.</span> <span class="toc-text">布尔类型</span></a></li></ol></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%8C%E6%95%B4%E6%80%A7-%E4%B8%BB%E9%94%AE"><span class="toc-number">18.</span> <span class="toc-text">数据完整性-主键</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%8C%E6%95%B4%E6%80%A7-%E8%81%94%E5%90%88%E4%B8%BB%E9%94%AE"><span class="toc-number">19.</span> <span class="toc-text">数据完整性-联合主键</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%94%E5%90%88%E4%B8%BB%E9%94%AE"><span class="toc-number">19.1.</span> <span class="toc-text">联合主键</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%8C%E6%95%B4%E6%80%A7-%E5%94%AF%E4%B8%80%E7%BA%A6%E6%9D%9F"><span class="toc-number">20.</span> <span class="toc-text">数据完整性-唯一约束</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%8C%E6%95%B4%E6%80%A7-%E8%87%AA%E5%8A%A8%E5%A2%9E%E9%95%BF%E7%BA%A6%E6%9D%9F"><span class="toc-number">21.</span> <span class="toc-text">数据完整性-自动增长约束</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E4%BD%93%E5%AE%8C%E6%95%B4%E6%80%A7"><span class="toc-number">22.</span> <span class="toc-text">实体完整性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%9F%E5%AE%8C%E6%95%B4%E6%80%A7"><span class="toc-number">23.</span> <span class="toc-text">域完整性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8%E4%B8%8E%E8%A1%A8%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">24.</span> <span class="toc-text">表与表之间的关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E7%85%A7%E5%AE%8C%E6%95%B4%E6%80%A7"><span class="toc-number">25.</span> <span class="toc-text">参照完整性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E7%85%A7%E5%AE%8C%E6%95%B4%E6%80%A7-1"><span class="toc-number">26.</span> <span class="toc-text">参照完整性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E7%85%A7%E5%AE%8C%E6%95%B4%E6%80%A7-%E5%A4%96%E9%94%AE%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">27.</span> <span class="toc-text">参照完整性 外键的操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E7%85%A7%E5%AE%8C%E6%95%B4%E6%80%A7-%E5%A4%9A%E5%AF%B9%E5%A4%9A%E5%A4%96%E9%94%AE"><span class="toc-number">28.</span> <span class="toc-text">参照完整性 多对多外键</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">29.</span> <span class="toc-text">单表查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="toc-number">30.</span> <span class="toc-text">模糊查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E8%A1%A8%E6%9F%A5%E8%AF%A2-order-by"><span class="toc-number">31.</span> <span class="toc-text">单表查询 order by</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-number">32.</span> <span class="toc-text">聚合函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%88%86%E7%BB%84"><span class="toc-number">33.</span> <span class="toc-text">数据分组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2-having"><span class="toc-number">34.</span> <span class="toc-text">条件查询 having</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%88%86%E9%A1%B5"><span class="toc-number">35.</span> <span class="toc-text">数据分页</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E9%80%89%E9%A1%B9"><span class="toc-number">36.</span> <span class="toc-text">查询选项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">37.</span> <span class="toc-text">多表查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8%E7%9A%84%E8%BF%9E%E6%8E%A5"><span class="toc-number">38.</span> <span class="toc-text">表的连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E7%84%B6%E8%BF%9E%E6%8E%A5"><span class="toc-number">39.</span> <span class="toc-text">自然连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#using%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">40.</span> <span class="toc-text">using关键字</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">41.</span> <span class="toc-text">子查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E4%BB%8B%E7%BB%8D"><span class="toc-number">42.</span> <span class="toc-text">事务介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E5%8E%9F%E7%90%86%E5%92%8C%E4%BD%BF%E7%94%A8"><span class="toc-number">43.</span> <span class="toc-text">事务原理和使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E5%9B%9E%E6%BB%9A%E7%82%B9"><span class="toc-number">44.</span> <span class="toc-text">事务回滚点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%89%B9%E7%82%B9"><span class="toc-number">45.</span> <span class="toc-text">事务特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">46.</span> <span class="toc-text">事务隔离级别</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%84%8F%E8%AF%BB"><span class="toc-number">46.0.1.</span> <span class="toc-text">脏读</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8D%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB"><span class="toc-number">46.0.2.</span> <span class="toc-text">不可重复读</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E5%A4%8D%E8%AF%BB"><span class="toc-number">46.0.3.</span> <span class="toc-text">重复读</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%B2%E8%A1%8C%E5%8C%96"><span class="toc-number">46.0.4.</span> <span class="toc-text">串行化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">47.</span> <span class="toc-text">视图基本概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">48.</span> <span class="toc-text">视图基本操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A7%86%E5%9B%BE%E5%AE%8C%E6%95%B4%E8%AF%AD%E5%8F%A5"><span class="toc-number">49.</span> <span class="toc-text">创建视图完整语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E8%A7%86%E5%9B%BE"><span class="toc-number">50.</span> <span class="toc-text">更新视图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mysql%E9%A2%84%E5%A4%84%E7%90%86"><span class="toc-number">51.</span> <span class="toc-text">Mysql预处理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%A0%E7%BB%9Fmysql-%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B"><span class="toc-number">51.0.1.</span> <span class="toc-text">传统mysql 处理流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%84%E5%A4%84%E7%90%86%E7%9A%84%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B"><span class="toc-number">51.0.2.</span> <span class="toc-text">预处理的处理流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mysql-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">52.</span> <span class="toc-text">Mysql 存储过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mysql-%E5%8F%98%E9%87%8F%E5%AD%98%E5%82%A8"><span class="toc-number">53.</span> <span class="toc-text">Mysql 变量存储</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mysql-%E5%82%A8%E5%AD%98%E8%BF%87%E7%A8%8B%E6%B7%B1%E5%85%A5"><span class="toc-number">54.</span> <span class="toc-text">Mysql 储存过程深入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0"><span class="toc-number">55.</span> <span class="toc-text">自定义函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5"><span class="toc-number">56.</span> <span class="toc-text">条件语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86"><span class="toc-number">57.</span> <span class="toc-text">批量数据处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mysql-%E7%B4%A2%E5%BC%95%E4%BB%8B%E7%BB%8D"><span class="toc-number">58.</span> <span class="toc-text">Mysql 索引介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%9B%E5%BB%BA%E5%92%8C%E4%BF%AE%E6%94%B9"><span class="toc-number">59.</span> <span class="toc-text">索引的创建和修改</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%AE%97%E6%B3%95"><span class="toc-number">60.</span> <span class="toc-text">索引算法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Node%E4%B8%8EMysql"><span class="toc-number">61.</span> <span class="toc-text">Node与Mysql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sequelize"><span class="toc-number">62.</span> <span class="toc-text">Sequelize</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sequelize%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">63.</span> <span class="toc-text">Sequelize基本使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sequelize%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="toc-number">64.</span> <span class="toc-text">Sequelize创建表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sequelize-CLI%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">65.</span> <span class="toc-text">Sequelize-CLI创建数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sequelize-CLI%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="toc-number">66.</span> <span class="toc-text">Sequelize-CLI创建表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sequelize-CLI%E4%BF%AE%E6%94%B9%E8%A1%A8"><span class="toc-number">67.</span> <span class="toc-text">Sequelize-CLI修改表</span></a></li></section><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="https://cdn.jsdelivr.net/gh/kitety/blog_img@master/img/2.jpg" alt="avatar"></div><p class="sidebar-ov-author__text">独特为佳</p></div><div class="sidebar-ov-social"><a class="sidebar-ov-social-item" href="https://github.com/kitety" target="_blank" rel="noopener" data-popover="Github" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-github"></i></span></a><a class="sidebar-ov-social-item" href="mailto:aizaizuori@gmail.com" target="_blank" rel="noopener" data-popover="Email" data-popover-pos="up"><span class="sidebar-ov-social-item__icon">Gmail</span></a><a class="sidebar-ov-social-item" href="tencent://message?uin=1048444579" target="_blank" rel="noopener" data-popover="QQ" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-qq"></i></span></a></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">48</div><div class="sidebar-ov-state-item__name">归档</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">24</div><div class="sidebar-ov-state-item__name">标签</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="知识共享许可协议" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">你已阅读了 </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2024</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>kitety</span></div><div><span>由 <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> 强力驱动</span><span> v5.4.2</span><span class="footer__devider">|</span><span>主题 - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.6.2</span></div><div class="busuanzi"><span class="busuanzi-siteuv"><span class="busuanzi-siteuv__icon"><i class="fas fa-user"></i></span><span class="busuanzi-siteuv__info">访问人数</span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_uv"></span></span><span class="busuanzi-sitepv"><span class="busuanzi-siteuv__icon"><i class="fas fa-eye"></i></span><span class="busuanzi-siteuv__info">浏览总量</span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_pv"></span></span></div><div><span class="post-meta-item-icon"><i class="fa fa-chart-area"></i> </span><span>字数统计： 152k</span></div><span id="jinrishici-sentence">正在加载今日诗词....</span><script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script><div id="poem" style="margin-bottom:20px"></div><script>window.onload=function(){function o(){$.get("https://v1.hitokoto.cn",function(o,t){"success"==t&&$("#poem").html(o.hitokoto)})}$&&($(document).on("pjax:complete",function(){o(),Stun.utils.registerShowReward(),socialShare(".social-share, .share-component")}),o())}</script></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><div class="search-mask"></div><div class="search-popup"><span class="search-close"></span><div class="search-input"><input placeholder="搜索文章（支持多关键词，请用空格分隔）"><div class="search-btns">使用搜索：<span class="search-btns-item search-btns-item--google"><i class="fab fa-google"></i>谷歌</span><span class="search-btns-item search-btns-item--bing"><i></i>必应</span><span class="search-btns-item search-btns-item--baidu"><i></i>百度</span></div></div><div class="search-results"></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script><script src="https://cdn.jsdelivr.net/npm/ribbon.js@latest/dist/ribbon.min.js" size="120" alpha="0.6" zindex="-1"></script><script src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1.0.1/dist/canvas-nest.min.js" color="0,0,0" opacity="0.6" count="99" zindex="-1"></script><script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lazyload@2.0.0-rc.2/lazyload.min.js"></script><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><script>console.log(111)</script><script>function initSearch(){var c=!0,t="search.xml",t=(t?/json$/i.test(t)&&(c=!1):t="search.xml","/"+t);$.ajax({url:t,dataType:c?"xml":"json",async:!0,success:function(t){function e(){var t=o.val().toLowerCase().trim(),h=t.split(/[\s]+/),d=[],e=(1<h.length&&h.push(t),0<t.length&&n.forEach(function(t){var e=!1,n=t.title&&t.title.trim()||"[ 文章无标题 ]",o=n&&n.toLowerCase(),i=t.content&&t.content.replace(/<[^>]+>/g,""),c=i&&i.toLowerCase(),t=t.url&&decodeURI(t.url).replace(/\/{2,}/g,"/"),a=[],s=[],r=(h.forEach(function(t){function e(e,t,n,o){if(!e||!t)return[];var i,c=0,s=[];for(n||(e=e.toLowerCase(),t=t.toLowerCase());-1!==(i=t.indexOf(e,c));){var r=!1;a.forEach(function(t){t.index===i&&t.word.length<e.length&&(t.word=e,r=!0)}),c=i+e.length,r||s.push({index:i,word:e,weight:o})}return s}a=a.concat(e(t,o,!1,f.title)),s=s.concat(e(t,c,!1,f.content))}),a.length),l=s.length;function u(n,t,e,o){var i,c;if(n&&t&&t.length)return i="",c=e,e=o,t.forEach(function(t){var e;t.index<c||(e=t.index+t.word.length,i=(i+=n.slice(c,t.index))+("<b>"+n.slice(t.index,e))+"</b>",c=e)}),i+=n.slice(c,e)}(e=0<r||0<l?!0:e)&&([a,s].forEach(function(t){t.sort(function(t,e){return t.index-e.index})}),r={},l=a.length*f.title+s.length*f.content,e=u(n,a,0,n.length)||n,n=0<s.length?(n=s[0].index,u(i,s,20<n?n-20:0,n+180)):i.slice(0,200),r.title=e,r.content=n,r.url=t,r.weight=l,d.push(r))}),"");d.length?(d.sort(function(t,e){return e.weight-t.weight}),e+="<ul>",d.forEach(function(t){e=(e=(e+='<li><a class="search-results-title" href="'+t.url+'">')+t.title+'</a><div class="search-results-content">')+t.content+"</div></li>"}),e+="</ul>"):e+='<div class="search-results-none"><i class="far fa-meh"></i></div>',i.html(e)}var n=c?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,o=$(".search-input input"),i=$(".search-results"),f={title:100,content:1};o.on("input",e),o.on("keyup",function(t){t.keyCode===Stun.utils.codeToKeyCode("Enter")&&e()})}})}function closeSearch(){$("body").css({overflow:"auto"}),$(".search-popup").css({display:"none"}),$(".search-mask").css({display:"none"})}function safeOpenUrl(t){var e=window.open();e.opener=null,e.location=t}function extSearch(t){var e=window.location.host,n=$(".search-input input").val().toLowerCase().trim();n?safeOpenUrl({google:"https://www.google.com/search?q=",bing:"https://cn.bing.com/search?q=",baidu:"https://www.baidu.com/s?ie=UTF-8&wd="}[t]+n+" site:"+e):Stun.utils.popAlert("warning","请输入字符")}window.addEventListener("DOMContentLoaded",function(){Stun.utils.pjaxReloadLocalSearch=function(){$(".header-nav-search").on("click",function(t){t.stopPropagation(),$("body").css("overflow","hidden"),$(".search-popup").velocity("stop").velocity("transition.expandIn",{duration:300,complete:function(){$(".search-popup input").focus()}}),$(".search-mask").velocity("stop").velocity("transition.fadeIn",{duration:300}),initSearch()}),$(".search-mask, .search-close").on("click",function(){closeSearch()}),$(document).on("keydown",function(t){t.keyCode===Stun.utils.codeToKeyCode("Escape")&&closeSearch()})},Stun.utils.pjaxReloadLocalSearch()},!1);var assistSearchList=window.CONFIG.assistSearch;Array.isArray(assistSearchList)&&assistSearchList.forEach(function(t){document.querySelector(".search-btns-item--"+t).addEventListener("click",function(){extSearch(t)},!1)})</script><script src="https://cdn.jsdelivr.net/npm/pjax@latest/pjax.min.js"></script><script>window.addEventListener("DOMContentLoaded",function(){new Pjax({selectors:["head title","#main",".pjax-reload",".header-inner"],history:!0,scrollTo:0,scrollRestoration:!0,cacheBust:!1,debug:!1,currentUrlFullReload:!1,timeout:0});var e=null;document.addEventListener("pjax:send",function(){$(".header-nav-menu").removeClass("show"),CONFIG.pjax&&CONFIG.pjax.avoidBanner&&$("html").velocity("scroll",{duration:500,offset:$("#header").height(),easing:"easeInOutCubic"});var a=20;$(".loading-bar").addClass("loading"),$(".loading-bar__progress").css("width",a+"%"),clearInterval(e),e=setInterval(function(){95<(a+=3)&&(a=95),$(".loading-bar__progress").css("width",a+"%")},500)},!1),window.addEventListener("pjax:complete",function(){clearInterval(e),$(".loading-bar__progress").css("width","100%"),$(".loading-bar").removeClass("loading"),setTimeout(function(){$(".loading-bar__progress").css("width","0")},400),$("link[rel=prefetch], script[data-pjax-rm]").each(function(){$(this).remove()}),$("script[data-pjax], #pjax-reload script").each(function(){$(this).parent().append($(this).remove())}),Stun.utils.pjaxReloadBoot&&Stun.utils.pjaxReloadBoot(),Stun.utils.pjaxReloadScroll&&Stun.utils.pjaxReloadScroll(),Stun.utils.pjaxReloadSidebar&&Stun.utils.pjaxReloadSidebar(),Stun.utils.pjaxReloadHeader&&Stun.utils.pjaxReloadHeader(),Stun.utils.pjaxReloadScrollIcon&&Stun.utils.pjaxReloadScrollIcon(),Stun.utils.pjaxReloadLocalSearch&&Stun.utils.pjaxReloadLocalSearch()},!1)},!1)</script><div id="pjax-reload"><script src="https://cdn.jsdelivr.net/npm/quicklink@1.0.1/dist/quicklink.umd.js"></script><script>function initQuicklink(){quicklink({timeout:"10000",priority:!0,ignores:[i=>i.includes("#"),i=>"https://kitety.github.io/posts/mysql-study-note.html"===i,/\/api\/?/,i=>i.includes(".xml"),i=>i.includes(".zip"),(i,t)=>t.hasAttribute("nofollow"),(i,t)=>t.hasAttribute("noprefetch")]})}initQuicklink()</script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script></div><script data-pjax="">function loadDisqus(){var t,e,s;document.getElementById("disqus_thread")&&(window.DISQUS?DISQUS.reset({reload:!0,config:function(){this.page.url="https://kitety.github.io/posts/mysql-study-note.html",this.page.identifier="posts/mysql-study-note.html",this.page.title="Mysql 学习笔记"}}):(e=(t=document).createElement("script"),s=t.createElement("script"),e.src="https://kitety.disqus.com/count.js",e.id="dsq-count-scr",e.async=!0,e.setAttribute("data-pjax",""),(t.head||t.body).appendChild(e),s.src="https://kitety.disqus.com/embed.js",(t.head||t.body).appendChild(s)))}loadDisqus()</script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script><script type="application/json" src="/search.xml"></script><style>[bg-lazy]{background-image:none!important;background-color:#eee!important}</style><script>window.imageLazyLoadSetting={isSPA:!0,preloadRatio:1,processImages:null}</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})})</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var a=r.imageLazyLoadSetting.isSPA,n=r.imageLazyLoadSetting.preloadRatio||1,d=o();function o(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(t){(a||t)&&(d=o());for(var e,i=0;i<d.length;i++)0<=(e=(e=d[i]).getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(r.innerHeight*n||document.documentElement.clientHeight*n)&&function(){var t,e,a,n=d[i],o=function(){d=d.filter(function(t){return n!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(n)};(t=n).dataset.loaded||(t.hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),o()):(e=new Image,a=t.getAttribute("data-original"),e.onload=function(){t.src=a,t.removeAttribute("data-original"),t.setAttribute("data-loaded",!0),o()},e.onerror=function(){t.removeAttribute("data-original"),t.setAttribute("data-loaded",!1),t.src=a},t.src!==a&&(e.src=a)))}()}function e(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",e),r.addEventListener("resize",e),r.addEventListener("orientationchange",e)}(this)</script></body><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@1.2.0/dist/Meting.min.js"></script><div class="aplayer" data-id="5197008428" data-server="netease" data-type="playlist" data-fixed="true" data-order="random" data-volume="0.65" data-autoplay="false" date-preload="auto" data-theme="#cc543a"></div><style>.new-site{height:60px;font-size:24px;border:4px solid red;display:flex;align-items:center;justify-content:center}</style></html>